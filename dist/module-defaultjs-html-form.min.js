(()=>{"use strict";var t={302:(t,e,i)=>{i.r(e),i.d(e,{default:()=>a});const a=void 0!==i.g?i.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}}},e={};function i(a){var s=e[a];if(void 0!==s)return s.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};(()=>{i.r(a),i.d(a,{BaseField:()=>Gt,BaseSubmitAction:()=>Be,Container:()=>he,Field:()=>re,Form:()=>Ke,List:()=>Ee,Page:()=>ze,SubmitActionResult:()=>$e});const t=500,e="d-form",s="d-page",n="d-rows",r="d-row",o="d-step",l="d-control-back",u="d-control-next",c="d-control-summary",d="d-control-submit",h="init",p="validating",g="input",f="summary",v="finished",m="d-form-initialized",y="d-form-site-changed",b="d-form-state-changed",w="d-form-field-input",x="d-form-list-row-add",A="d-form-list-row-delete",P="d-form-field-initialized",V="d-form-field-removed",E="d-form-page-initialized",N="d-form-page-removed",D="d-form-validation-initialized",z="d-form-validation-removed",M="d-form-message-initialized",O="d-form-message-removed",T="d-form-editable-state-changed",C="name",S="endpoint",k="method",I="state",j="step",U="use-summary-page",R="input-mode-after-submit",H="required",F="condition",L="active",$="disabled",_="editable",B="editable-condition",q="readonly",G="no-value",W="valid",J="invalid",X="evaluate",Z="condition-valid",K="condition-invalid",Q="min",Y="max",tt="progress",et=new WeakMap,it=t=>{if(et.has(t))return et.get(t);const e={};return et.set(t,e),e},at=function(t,e,i){const a=it(t);if(1===arguments.length)return a;if(2===arguments.length)return a[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");a[e]=i},st=t=>function(e,i){if(2!=arguments.length)return at(e,t);at(e,t,i)};class nt{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,i=!0){let a=t;const s=e.split(".");let n=s.shift().trim();for(;s.length>0;){if(!a[n]){if(!i)return null;a[n]={}}a=a[n],n=s.shift().trim()}return new nt(n,a)}}const rt=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},ot=function(t,...e){t||(t={});for(let i of e)rt(i)&&Object.getOwnPropertyNames(i).forEach((e=>{rt(t[e])?ot(t[e],i[e]):t[e]=i[e]}));return t},lt=function(){const[t,e,{deep:i=!1,recursive:a=!0,parents:s=[]}={}]=arguments,n={};for(let r in t){const o=t[r],l=e(r,o,t);!l||i&&null!=o?l&&i&&("object"!=typeof o||o instanceof Array||o instanceof Map||o instanceof Set||o instanceof RegExp||s.includes[o]||o==t?n[r]=o:n[r]=lt(o,e,{deep:i,recursive:a,parents:s.concat(t)})):n[r]=o}return n},ut=(t,e,i)=>{Object.defineProperty(t,e,{value:i,writable:!1,configurable:!1,enumerable:!1})},ct=(t,e,i)=>{Object.defineProperty(t,e,{get:i,configurable:!1,enumerable:!1})},dt={isPojo:rt,append:function(t,e,i){return void 0!==e&&(nt.load(i,t,!0).append=e),i},merge:ot,filter:lt,buildPropertyFilter:function({names:t,allowed:e}){return(i,a,s)=>t.includes(i)===e},defValue:ut,defGet:ct,defGetSet:(t,e,i,a)=>{Object.defineProperty(t,e,{get:i,set:a,configurable:!1,enumerable:!1})}},ht=()=>{let t=null,e=null;const i=new Promise(((i,a)=>{t=i,e=a}));let a,s=!1,n=!1;return ut(i,"resolve",(i=>{a=i,s=!0,a instanceof Error?(n=!0,e(a)):t(a)})),ct(i,"value",(()=>a)),ct(i,"error",(()=>n)),ct(i,"resolved",(()=>s)),i},pt=(t,e)=>{let i="unsupported";if("string"==typeof e)i=e;else if(e instanceof HTMLElement)i=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+' is not supported as parameter "node"!');i=e.NODENAME}return`${i.toLowerCase()}:${t}`},gt=st("ready"),ft=new WeakMap,vt=t=>class extends t{constructor({shadowRoot:t=!1,content:e=null,createUID:i=!1,uidPrefix:a="id-",uidSuffix:s=""}={}){super(),gt(this,ht()),i&&this.attr("id",i(a,s)),t&&this.attachShadow({mode:open}),e&&this.root.append("function"==typeof e?e(this):e)}get root(){return this.shadowRoot||this}get ready(){return gt(this)}async init(){}async destroy(){this.ready.resolved&&gt(this,ht())}connectedCallback(){this.ownerDocument==document&&(t=>{let e=ft.get(t);e&&clearTimeout(e),ft.get(t,setTimeout((async()=>{ft.delete(t);try{await t.init(),t.ready.resolve()}catch(e){console.error("Can't initialize component!",t,e),t.ready(resolve(e))}t.trigger(pt("initialzed",t))}),100))})(this)}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,i){e!=i&&this.isConnected&&(this.trigger(100,pt(`attribute--${t}`,this)),this.trigger(100,pt("change",this)))}disconnectedCallback(){this.destroy()}},mt=new Map,yt=(t=>{let e=mt.get(t);return null==e&&(e=vt(t),mt.set(t,e)),e})(HTMLElement);var bt=i(302);class wt{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class xt{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let i=null;if(this.data&&t in this.data)i={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;i=((t,e)=>{for(;t;){const i=t.proxy.handle.getPropertyDef(e,!1);if(i)return i;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return i.defined&&this.cache.set(t,i),i}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:i,defined:a}=this.getPropertyDef(t);a?i[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class At{constructor(t,e){this.handle=new xt(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,i){return t.setProperty(e,i)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const Pt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,Vt=new wt,Et=t=>t instanceof wt?t:new wt(t),Nt=async function(t,e,i,a){if(i&&t.name!=i)return t.parent?Nt(t.parent,e,i,a):null;const s=await async function(t,e){if("string"!=typeof t)return t;const i=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context)`);let a,s=setTimeout((()=>{s=null,console.warn("long running statement:",t,new Error)}),1e3);try{a=await i(e)}catch(t){}return s&&clearTimeout(s),a}(e,t.proxy.data);return null!=s?s:a instanceof wt&&a.hasValue?a.value:void 0},Dt=async(t,e,i)=>e[1]?e[2]:Nt(t,e[5],zt(e[4]),i),zt=t=>t?0==(t=t.trim()).length?null:t:null;class Mt{constructor({context:t=bt.default,parent:e=null,name:i=null}){this.parent=e instanceof Mt?e:null,this.name=i,this.context=t,this.proxy=new At(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=nt.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,i){t&&(i&&i!=this.name?this.parent&&this.parent.updateData(t,e,i):(null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context)),nt.load(this.context,t).value=e,this.proxy.resetCache()))}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?dt.merge(this.context,t):t}async resolve(t,e){const i=2==arguments.length?Et(e):Vt;try{const e=Pt.exec(t);return e?await Dt(this,e,i):await Nt(this,zt(t),null,i)}catch(e){return console.error('error at executing statment"',t,'":',e),i.hasValue?i.value:t}}async resolveText(t,e){let i=t,a=t,s=Pt.exec(i);const n=2==arguments.length?Et(e):Vt;for(;null!=s;){const t=await Dt(this,s,n);a=a.split(s[0]).join(),i=i.split(s[0]).join(void 0===t?"undefined":null==t?"null":t),s=Pt.exec(a)}return i}static async resolve(t,e,i,a){const s=new Mt({context:e}),n=arguments.length>2?Et(i):Vt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(s.resolve(t,n))}),a)})):s.resolve(t,n)}static async resolveText(t,e,i,a){const s=new Mt({context:e}),n=arguments.length>2?Et(i):Vt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(s.resolveText(t,n))}),a)})):s.resolveText(t,n)}static buildSecure({context:t,propFilter:e,option:i={deep:!0},name:a,parent:s}){return t=dt.filter({data:t,propFilter:e,option:i}),new Mt({context:t,name:a,parent:s})}}const Ot=t=>null==t||void 0===t,Tt=async(t,e,i)=>(Ot(i)||(e?kt(t,e,i):Object.assign(t,i)),t),Ct=async(t,e)=>{let i={};if(e)for(let t of e){const e=t.name,a=await t.value();i=await Tt(i,e,a)}else for(let[{name:e},a]of t)i=await Tt(i,e,a);return i},St=/\./g,kt=function(t,e,i){const a=e.split(St);if(2==arguments.length)return jt(t,a);const s=Ot(i);return Ot(t)&&s?t:It(s,t,i,a)},It=(t,e,i,a)=>{if(Ot(e)&&t)return null;const s=a.shift();return 0==a.length?t?delete e[s]:e[s]=i:(Ot(e[s])&&(e[s]={}),It(t,e[s],i,a)),e},jt=(t,e)=>{if(Ot(t))return null;if(0==e.length)return t;const i=e.shift();return jt(t[i],e)},Ut=(t,e,i=!1)=>{const a=t.active;e?t.attr(L,""):t.attr(L,null),(a!=e||i)&&t.trigger("d-form-active-state-changed")},Rt=(t,e,i=!1)=>{const a=t.readonly;e?t.attr(q,""):t.attr(q,null),(a!=e||i)&&t.trigger(T)},Ht=st("form"),Ft=[L,q,F,Z,K,B],Lt=class extends yt{static get observedAttributes(){return Ft}#t;#e;#i;#a;constructor(){super(),this.#a=new class{#s=new Set;constructor(t){t.on(M,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#s.add(e)})),t.on(O,(t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this.#s.delete(e)}))}async validate(t){for(let e of this.#s)e.update(t)}}(this),this.#t=new class{#n;#r;constructor(t){this.#n=t}get condition(){return this.#r||(this.#r=this.#n.attr(F)||!1),this.#r}async validate(t){const e=this.#n;let i=this.condition;const a=e.condition;return i=!i||await Mt.resolve(i,t,!1),i!=a&&(e.condition=i),i}}(this),this.#e=new class{#n;#r=null;constructor(t){this.#n=t}get condition(){return null==this.#r&&(this.#r=this.#n.attr(B)||""),this.#r}async validate(t){let e=!0;const i=this.#n.editable;return this.condition&&(e=await Mt.resolve(this.condition,t,!1)),e!=i&&(this.#n.editable=e),e}}(this),this.#i=new class{#n;#o=new Set;#l=new Set;constructor(t){this.#n=t,t.on(D,(t=>{t.stopPropagation(),this.#o.add(t.target)})),t.on(z,(t=>{t.stopPropagation(),this.#o.delete(t.target)}))}addCustomValidation(t){this.#l.add(t)}async validate(t){const e=this.#n,i=this.#l,a=this.#o,{hasValue:s,required:n,condition:r,editable:o}=(this.#n.valid,this.#n);let l=!0;if(r){l=!n||s,await(async(t,e,i)=>{let a=!0;for(let s of t)await s({data:e,base:i})||(a=!1);return a})(i,t,e)||(l=!1);for(let e of a)if(l&&s){const i=await Mt.resolve(e.condition,t,!0);e.active=!i,i||(l=!1)}else e.active=!1}return e.valid=l,l}}(this)}addValidation(t){this.#i.addCustomValidation(t)}async validate(t){this.attr(X,"");const e=Object.assign({},t,await(async t=>{await t.ready;const e={};e.$value=_t(t);let i=t.parent(r),a=e;for(;i;)a.$item=await _t(i),a=a.$item,i=i.parent(r);return e})(this));return await this.#t.validate(e),await this.#e.validate(e),await this.#i.validate(e),this.attr(X,null),await this.#a.validate(e),this.valid}get form(){let t=Ht(this);return t||(t=this.parent(e),Ht(this,t)),t}get active(){return this.hasAttribute(L)}set active(t){this.active!=t&&(Ut(this,t),this.activeUpdated())}async activeUpdated(){}get readonly(){return this.hasAttribute(q)}set readonly(t){this.editable?Rt(this,t,!this.ready.resolved):Rt(this,!0,!this.ready.resolved),this.readonlyUpdated()}async readonlyUpdated(){}get editable(){return this.hasAttribute(_)}set editable(t){((t,e,i=!1)=>{const a=t.editable;e?t.attr(_,""):t.attr(_,null),(a!=e||i)&&t.trigger(T)})(this,t,!this.ready.resolved),this.editableUpdated(),this.readonly=!t}async editableUpdated(){}set condition(t){var e,i;e=this,void 0===(i=t)||null==i?(e.attr(K,null),e.attr(Z,null)):i?(e.attr(K,null),e.attr(Z,"")):(e.attr(Z,null),e.attr(K,"")),e.trigger("d-form-condition-state-changed"),this.conditionUpdated()}get condition(){return!this.hasAttribute(K)}async conditionUpdated(){}set valid(t){((t,e)=>{void 0===e||null==e?(t.attr(J,null),t.attr(W,null)):e?(t.attr(J,null),t.attr(W,"")):(t.attr(J,""),t.attr(W,null)),t.trigger("d-form-valid-state-changed")})(this,t),this.validUpdated()}get valid(){return this.hasAttribute(W)}async validUpdated(){}},$t=st("parent"),_t=st("value"),Bt=[C,H,G];class qt extends Lt{static get observedAttributes(){return Bt.concat(Lt.observedAttributes)}constructor({initEvent:t=P,value:e=null}={}){super(),_t(this,e),t&&this.ready.then((()=>this.trigger(t)))}async destroy(){this.trigger(V),this.publishValue(null),await super.destroy()}get parentField(){let t=$t(this);return t||(t=(t=>{let e=this.parentNode;for(;e;){if(e instanceof qt)return e;e=e.parentNode}return null})(),$t(this,t)),t}async conditionUpdated(){return this.active=this.condition,this.publishValue()}get name(){return this.getAttribute(C)}get required(){return this.hasAttribute(H)}get hasValue(){return!this.hasAttribute(G)}async value(t){const{condition:e,valid:i,ready:a}=this;if(0==arguments.length)return e&&i?_t(this):null;await a;const s=_t(this);await this.acceptValue(t)&&s!=(t=await this.normalizeValue(t)||t)&&(t=await this.updatedValue(t)||t,await this.publishValue(t))}async validate(t){const e=this.condition,i=this.valid,a=await super.validate(t);return(e!=this.condition||i!=a)&&this.publishValue(),a}async updatedValue(t){}async publishValue(t){await this.ready;let e=!1;const i=_t(this);var a;t=1==arguments.length?t:i,1==arguments.length&&i!=t&&(e=!0,_t(this,t)),a=!Ot(t),this.attr(G,a?null:"");const s=this.condition&&(this.valid||e)?t:null;this.parentField?await this.parentField.childValueChanged(this,s):await this.form.childValueChanged(this,s)}async acceptValue(t){return!0}async normalizeValue(t){return t}async childValueChanged(t,e){}}const Gt=qt,Wt=(t,e,i,a)=>{let s=null;const n="function"==typeof e?e:()=>e,r="function"==typeof i?i:()=>i;return e=>{n(e)&&e.preventDefault(),r(e)&&e.stopPropagation();const i=(t=>({type:t.type,target:t.target,detail:t.detail,currentTarget:t.currentTarget,explicitOriginalTarget:t.explicitOriginalTarget,originalTarget:t.originalTarget,srcElement:t.srcElement,timeStamp:t.timeStamp}))(e);s&&clearTimeout(s),s=setTimeout((()=>{s=null,t(i)}),a||10)}};class Jt{static findInput(t){return null}constructor(t,e){this.field=t,this.input=e,this.init()}init(){}set readonly(t){}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}get value(){return null}get valid(){return!0}}const Xt=t=>({accept:t=>"number"==typeof t,getValue:()=>t.valueAsNumber,setValue:e=>{t.valueAsNumber=e},normalize:t=>Ot(t)||Number.isNaN(t)?null:t}),Zt=t=>({accept:t=>t instanceof Date,getValue:()=>t.valueAsDate,setValue:e=>{t.valueAsDate=e},normalize:t=>t||null}),Kt={text:t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>t.value=e,normalize:t=>t&&(t=t.trim()).length>0?t:null}),number:Xt,date:Zt,time:Zt,range:Xt},Qt=st("value"),Yt=(t,e)=>new Promise(((i,a)=>{const s=new FileReader;s.addEventListener("loadend",(()=>{i({name:t.name,type:t.type,size:t.size,data:s.result})}),!1),s[e](t)})),te={"form-input":async t=>(t.format="form-input",t),"data-url-base64":async t=>{const e=await Yt(t,"readAsDataURL");return e.format="data-url-base64",e},base64:async t=>{const e=await Yt(t,"readAsDataURL");return e.data=e.data.substr(e.data.indexOf(",")+1),e.format="base64",e}},ee=async(t,e,i)=>{let a=[];for(let i of t)a.push(await te[e](i));return 0==a.length?null:i?a:a[0]},ie=[class extends Jt{static findInput(t){return t.find('input:not([type="file"]):not([type="radio"]):not([type="checkbox"]) ,input:not([type]), textarea').first()}constructor(t,e){super(t,e)}init(){const{field:e,input:i}=this,a=(e.attr("input-type")||i.attr("type")||"text").trim().toLowerCase();this.type=(Kt[a]||Kt.text)(i),i.on("input",Wt((()=>{e.trigger(w,this.normalizeValue(this.value))}),!1,!0,t)),e.trigger(w,this.normalizeValue(this.value))}acceptValue(t){return null==t||void 0===t||this.type.accept(t)}normalizeValue(t){return null==t&&void 0===t?null:this.type.normalize(t)}async updatedValue(t){t!=this.type.getValue()&&this.type.setValue(t)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.type.getValue()}get valid(){return this.input.checkValidity()}},class extends Jt{static findInput(t){const e=t.find('input[type="checkbox"]');return 0==e.length?null:1==e.length?e.first():e}constructor(t,e){super(t,e)}init(){const{field:e,input:i}=this;this.multiple=i instanceof NodeList,i.on("input",Wt((()=>{e.trigger(w,this.normalizeValue(this.value))}),!1,!0,t)),e.trigger(w,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();if(!(t instanceof Map))return t;if(0==t.size)return null;const e=[];return t.forEach((t=>{e.push(t)})),e}normalizeValue(t){return t?this.multiple?0!=(t=t.filter((t=>!!t))).length?t:null:t:null}acceptValue(t){if(null==t||void 0===t)return!0;if(this.multiple)return t instanceof Array;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}},class extends Jt{static findInput(t){const e=t.find('input[type="radio"]');return 0==e.length?null:e}constructor(t,e){super(t,e)}init(){const{field:e,input:i}=this,a=e.name+Math.floor(Math.random()*Date.now());for(let t of i)t.name=a;i.on("input",Wt((()=>{e.trigger(w,this.normalizeValue(this.value))}),!1,!0,t)),e.trigger(w,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();return t instanceof Map?0==t.size?null:t.values().next().value:t}normalizeValue(t){return t||null}acceptValue(t){if(null==t||void 0===t)return!0;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}},class extends Jt{static findInput(t){return t.find('input[type="file"]').first()}constructor(t,e){super(t,e)}async init(){const{field:t,input:e}=this;this.multiple=e.multiple,this.format=t.attr("file-format")||"form-input",this.filenameTarget=t.attr("file-name-target"),this.filenameTarget=this.filenameTarget?t.find(this.filenameTarget).first():null;const{format:i,multiple:a}=this;e.on("input",Wt((async()=>{this.updatedValue(await ee(e.files,i,a)),t.trigger(w,this.value)}),!1,!0)),e.files&&0!=e.files.length&&this.updatedValue(await ee(e.files,i,a)),t.trigger(w,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}acceptValue(t){return null==t||void 0===t||(this.multiple?t instanceof Array:"object"==typeof t)}normalizeValue(t){return null==t||void 0===t?null:this.multiple?0!=t.length?t:null:t}updatedValue(t){if(t!=Qt(this)){Qt(this,t),t||(this.input.value=null);const e=this.filenameTarget;if(e&&(e.empty(),t))if(this.multiple)for(let i of t)e.append(`<span>${i.name}</span>`);else e.append(`<span>${t.name}</span>`)}}get value(){return Qt(this)}get valid(){return this.input.checkValidity()}},class extends Jt{static findInput(t){return t.find("select").first()}constructor(t,e){super(t,e)}init(){const{field:e,input:i}=this;i.on("input, changed",Wt((()=>{e.trigger(w,this.value)}),!1,!0,t)),e.trigger(w,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.normalizeValue(this.input.multiple?this.input.val():this.input.value)}normalizeValue(t){return t?this.input.multiple?0!=(t=t.filter((t=>t&&t.trim().length>0))).length?t:null:0!=(t=t.trim()).length?t:null:null}acceptValue(t){return null==t||void 0===t||(this.input.multiple?t instanceof Array:"string"==typeof t)}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}}],ae=function(t,e){const i=t.NODENAME;customElements.get(i)||customElements.define(i,t,e)},se=["file-format"];class ne extends Gt{static get observedAttributes(){return se.concat(Gt.observedAttributes)}static get NODENAME(){return"d-field"}#u=!1;#c;constructor(t){super(t),this.on(w,(t=>{t.preventDefault(),t.stopPropagation(),this.publishValue(t.detail)}))}async init(){await super.init(),this.#u||(this.#u=!0,this.#c=(t=>{for(let e of ie){const i=e.findInput(t);if(i)return new e(t,i)}return null})(this),this.#c&&this.addValidation((async()=>this.#c.valid)))}readonlyUpdated(){this.#c&&(this.#c.readonly=this.readonly)}async acceptValue(t){return!!this.#c&&this.#c.acceptValue(t)}async normalizeValue(t){return this.#c?this.#c.normalizeValue(t):t}async updatedValue(t){await this.ready,t=await t;const e=this.#c;e&&e.value!=t&&await e.updatedValue(t),await super.updatedValue(t)}}ae(ne);const re=ne,oe=[L,F];ae(class extends yt{static get observedAttributes(){return oe}static get NODENAME(){return"d-validation"}constructor(){super()}async init(){await super.init(),this.active=!1,this.ready.then((()=>this.trigger(D)))}async destroy(){this.trigger(z),await super.destroy()}get active(){return this.hasAttribute(L)}set active(t){t?this.attr(L,""):this.attr(L,void 0)}get condition(){return this.attr(F)}});const le=({root:t,filter:e})=>{let i=[];return t.children.forEach((t=>{const{accept:a,stop:s=!1}=e(t);if(a&&i.push(t),!s){const a=le({root:t,filter:e});a instanceof Array?i=i.concat(a):a&&i.push(a)}})),i},ue=async(t,e)=>(await Promise.all(e.map((e=>e.validate(t))))).reduce(((t,e)=>!!t&&e),!0),ce=[];class de extends Gt{static get observedAttributes(){return ce.concat(Gt.observedAttributes)}static get NODENAME(){return"d-container"}#d=null;#h=new Map;constructor(t){super(t);const e=this.root;e.on(P,(t=>{const e=t.target;e!=this&&(e instanceof Gt&&(this.#d=null),t.preventDefault(),t.stopPropagation())})),e.on(V,(t=>{const e=t.target;e!=this&&(e instanceof Gt&&(this.#d=null),t.preventDefault(),t.stopPropagation())})),this.addValidation((async({data:t})=>await ue(t,this.fields)))}get fields(){return this.#d||(this.#d=le({root:this,filter:t=>t instanceof Gt?{accept:!0,stop:!0}:{accept:!1}})),Array.from(this.#d)}readonlyUpdated(){const{readonly:t,fields:e}=this;if(e)for(let i of e)i.readonly=t}async updatedValue(t){await this.ready,this.#h.clear();const e=this.fields;e&&await Promise.all(e.map((e=>e.name?e.value(kt(t,e.name)):e.value(t))));let i=await Ct(this.#h,e);return 0==Object.getOwnPropertyNames(i).length&&(i=null),i}async childValueChanged(t,e){e=await e;const i=this.#h;t&&(Ot(e)?i.delete(t):i.set(t,e));let a=await Ct(i,this.fields);0==Object.getOwnPropertyNames(a).length&&(a=null),await super.childValueChanged(t,e),await this.publishValue(a)}}ae(de);const he=de,pe=[L,$],ge=class extends yt{static get observedAttributes(){return pe}#u=!1;#p;constructor(){super(),this.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.active&&!this.disabled&&this.execute()}))}async init(){await super.init(),this.#u&&(this.active=!1,this.disabled=!1,this.#u=!0)}get form(){return this.#p||(this.#p=this.parent(e)),this.#p}get active(){return this.hasAttribute(L)}set active(t){this.attr(L,t?"":null)}get disabled(){return this.hasAttribute($)}set disabled(t){this.attr($,t?"":null)}execute(){console.log("execute")}},fe=[];ae(class extends ge{static get observedAttributes(){return fe.concat(fe)}static get NODENAME(){return"d-delete-row"}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(100,A)}});const ve=[];class me extends he{static get observedAttributes(){return ve.concat(he.observedAttributes)}static get NODENAME(){return r}constructor(t){super(t)}get active(){return!0}set active(t){}get condition(){return!0}get name(){return null}}customElements.define(me.NODENAME,me);const ye=[];class be extends ge{static get observedAttributes(){return ye.concat(ye)}static get NODENAME(){return"d-add-row"}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(100,x)}}ae(be);const we=be,xe=[];ae(class extends yt{static get observedAttributes(){return xe}static get NODENAME(){return n}constructor(){super()}});const Ae=[Q,Y],Pe=async(t,e)=>{let i=[];for(let a of t)i.push(e.get(a));return 0==i.length&&(i=null),i};class Ve extends Gt{static get observedAttributes(){return Ae.concat(Gt.observedAttributes)}static get NODENAME(){return"d-list"}#g;#f;#v=new Map;#m;#u=!1;constructor(t){super(t);const e=this.root;e.on(P,(t=>{t.target!=this&&(t.preventDefault(),t.stopPropagation())})),e.on(x,(t=>{t.preventDefault(),t.stopPropagation();const{readonly:e}=this;e||this.createRow()})),e.on(A,(t=>{t.preventDefault(),t.stopPropagation();const{rows:e,readonly:i}=this;if(!i){const i=t.target.parent(r);e.indexOf(i)>=0&&i.remove()}})),this.addValidation((async()=>{const{rows:t,min:e,max:i,readonly:a}=this,s=t.length;return a||(s==i?this.#m.disabled=!0:s<i&&(this.#m.disabled=!1)),e<=s&&s<=i})),this.addValidation((async t=>await ue(t,this.rows)))}async init(){await super.init(),this.#u||(this.#u=!0,this.#g=this.find("template").first().content,this.#f=this.find(n).first(),this.#m=le({root:this,filter:t=>t instanceof we?{accept:!0,stop:!0}:t instanceof Gt?{accept:!1,stop:!0}:{accept:!1}})[0])}readonlyUpdated(){const{readonly:t}=this;for(let e of this.rows)e.readonly=t}get rows(){return Array.from(this.#f.children)}get min(){return this.hasAttribute(Q)?Math.max(0,parseInt(this.attr(Q))):0}get max(){return this.hasAttribute(Y)?parseInt(this.attr(Y)):Number.MAX_SAFE_INTEGER}acceptValue(t){return!t||t instanceof Array}normalizeValue(t){return t?t.filter((t=>!!t)):null}async createRow(t){const e=document.importNode(this.#g,!0).children[0];return await this.#f.append(e),t&&await e.value(t),e}async updatedValue(t){return this.#v.clear(),this.#f.empty(),t&&await Promise.all(t.map((t=>this.createRow(t)))),await Pe(this.rows,this.#v)}async childValueChanged(t,e){e=await e;const i=this.#v;Ot(e)?this.#v.delete(t):this.#v.set(t,e),await super.childValueChanged(t,e);const a=await Pe(this.rows,i);await this.publishValue(a)}}ae(Ve);const Ee=Ve,Ne=[j];class De extends he{static get observedAttributes(){return Ne.concat(he.observedAttributes)}static get NODENAME(){return s}constructor(t){super(t),this.ready.then((()=>this.trigger(E)))}async destroy(){this.trigger(N),await super.destroy()}get step(){return this.attr(j)}conditionUpdated(){}}ae(De);const ze=De,Me="active",Oe="condition",Te=[Me,Oe];ae(class extends yt{static get observedAttributes(){return Te}static get NODENAME(){return"d-message"}constructor(){super()}async init(){await super.init(),this.trigger(M)}async destroy(){this.trigger(O),await super.destroy()}get active(){return this.hasAttribute(Me)}set active(t){t?this.attr(Me,""):this.attr(Me,void 0)}get condition(){return this.attr(Oe)}async update(t){await this.ready,this.active=await Mt.resolve(this.condition,t,!1)}});const Ce=[];ae(class extends ge{static get observedAttributes(){return Ce}static get NODENAME(){return l}constructor(){super()}execute(){this.form.toPrevPage()}});const Se=[];ae(class extends ge{static get observedAttributes(){return Se}static get NODENAME(){return u}constructor(){super()}execute(){this.form.toNextPage()}});const ke=[];ae(class extends ge{static get observedAttributes(){return ke}static get NODENAME(){return c}constructor(){super()}execute(){this.form.toNextPage()}});const Ie=[];ae(class extends ge{static get observedAttributes(){return Ie}static get NODENAME(){return d}constructor(){super()}execute(){this.form.submit()}});const je={active:!0,disabled:!0},Ue=[];ae(class extends yt{static get observedAttributes(){return Ue}static get NODENAME(){return"d-control"}#p;#y;#b;#w;#x;#u=!1;constructor(){super()}async init(){await super.init(),this.#u||(this.#p=this.parent(e),this.#y=this.find(l).first()||je,this.#b=this.find(u).first()||je,this.#w=this.find(c).first()||je,this.#x=this.find(d).first()||je,this.#p.on([m,b,y],(()=>{this.update()})),this.#u=!0)}async update(){const t=this.#p,e=t.state,i=this.#y,a=this.#b,s=this.#w,n=this.#x;if(i.active=!0,i.disabled=!0,a.active=!1,a.disabled=!0,s.active=!1,s.disabled=!0,n.active=!1,n.disabled=!0,e==p)return;const{activePageIndex:r,activePage:o,nextPage:l,pages:u,useSummaryPage:c}=t,d=null!=await l;e==v?(i.disabled=!0,n.active=!0):e==f?(i.disabled=!1,n.active=!0,n.disabled=!t.valid):e==g&&(i.disabled=r<=0,d||!o.valid&&r+1<u.length?(a.active=!0,a.disabled=!o.valid):c&&e==g?(s.active=!0,s.disabled=!o.valid):(n.active=!0,n.disabled=!t.valid))}});const Re=[C,L,q];ae(class extends yt{static get observedAttributes(){return Re}static get NODENAME(){return o}constructor(){super()}get name(){return this.attr(C)}get active(){return this.hasAttribute(L)}set active(t){this.active!=t&&Ut(this,t)}get readonly(){return this.hasAttribute(q)}set readonly(t){t?this.attr(q,""):this.attr(q,null)}});const He=[tt];ae(class extends yt{static get observedAttributes(){return He}static get NODENAME(){return"d-progress-bar"}#p;#A;#u=!1;constructor(){super(),this.on("click",(({target:t})=>{if(!this.#p)return;if(t==this)return;const e=t.is(o)?t:t.parent(o),i=this.#p;if(!e)return;const{state:a,pages:s,activePage:n}=i,r=e.name;if(a==g||a==f){const t=((t,e,i)=>{for(let a of t){if(a.step==e&&a.condition)return a;if(a==i)return}return null})(s,r,n);t&&(i.activePage=t)}}))}async init(){if(await super.init(),this.progress=0,!this.#u){const t=this.#p=this.parent(e);this.#A=this.find(o),this.#p.on([y,b],(()=>{const e=t.state;if(p==e)return;const{activePageIndex:i,activePage:a,pages:s}=t;if(!a)return;const n=s.length,r=a?a.step:h,o=Math.floor(100*i/n);for(let t of this.steps){const i=t.name;e==g?(t.active=i==r,t.readonly=!1):e==f?(t.active=i==f,t.readonly=!1):(t.active=i==v,t.readonly=!0)}this.progress=e==f||e==v?100:o,this.trigger("d-form-progress-bar-changed")})),this.#u=!0}}get steps(){return Array.from(this.#A)}get progress(){return this.attr(tt)}set progress(t){this.style.setProperty&&this.style.setProperty("--progress",t+"%"),this.attr(tt,Math.max(0,Math.min(t,100)))}});const Fe="success",Le="fail",$e=class{static get STATE_SUCCESS(){return Fe}static get STATE_FAIL(){return Le}constructor(t,e,i,a){this.action=t,this.state=e,this.message=i,this.data=a}},_e=st("form"),Be=class extends yt{constructor(){super()}async init(){await super.init();const t=this.parent(e);_e(this,t),t&&this.trigger("d-form-initializesubmit-action")}get form(){return _e(this)}async accept(t={}){const e=this.attr(F);return!e||await Mt.resolve(e,t,!1)}async execute(t={}){return new $e(Le,"not implemented")}};class qe extends Be{static get NODENAME(){return"d-submit-action-default"}constructor(t,e){super(),this.endpoint=t,this.method=e}async execute(t){let e=this.endpoint;e=await ExpressionResolver.resolveText(e,t,e);const i=new URL(e,location),a=await fetch(i,{method:this.method,credentials:"include",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify(t)});return new $e(this,a.ok?Fe:Le,a)}}ae(qe);const Ge=qe,We=st("submitAction"),Je=[C,U,S,k,I,R],Xe=(t,e)=>{for(let i of t.pages)i.readonly=e,i.active=e};class Ze extends yt{static get observedAttributes(){return Je}static get NODENAME(){return e}#u=!1;#P=h;#V;#h=new Map;#E=null;#N=!1;constructor(){super();const t=this.root;t.on(E,(t=>{t.preventDefault(),t.stopPropagation()})),t.on(N,(t=>{const e=t.target;this.#V=null,this.childValueChanged(e,null),t.preventDefault(),t.stopPropagation()})),this.ready.then((()=>this.trigger(m)))}async init(){await super.init(),this.#u||(this.#u=!0,this.activePageIndex=-1,this.state=h,this.useSummaryPage=this.hasAttribute(U),this.activePageIndex=-1,this.pages.length>0&&this.toNextPage())}get pages(){return this.#V||(this.#V=Array.from(this.root.find(s))),this.#V}get state(){return this.#P}set state(t){const e=this.#P;t!=p&&(e==g&&t!=g?Xe(this,!0):e!=g&&t==g&&(Xe(this,!1),this.activePage&&(this.activePage.active=!0))),this.#P=t,e!=t&&this.trigger(b),this.attr(I,t)}get valid(){for(let t of this.pages)if(t.condition&&!t.valid)return!1;return!0}async value(t){if(await this.ready,this.#E&&await this.#E,0==arguments.length)return await Ct(this.#h,this.pages);this.state==g&&(await Promise.all(this.pages.map((e=>{const i=e.name;return i?e.value(kt(t,i)):e.value(t)}))),await this.#D())}get activePage(){return 0<=this.activePageIndex&&this.activePageIndex<this.pages.length?this.pages[this.activePageIndex]:null}set activePage(t){const e=this.activePage;t==e&&this.state==g||(e&&(e.active=!1),this.activePageIndex=this.pages.indexOf(t),t.active=!0,this.state!=g&&(this.state=g),this.scrollIntoView(),this.trigger(y))}get prevPage(){return(async()=>{const t=this.pages,e=this.activePageIndex-1,i=await this.value();for(let a=e;a>=0;a--){const e=t[a];if(await e.validate(i),e.condition)return e}return null})()}get nextPage(){return(async()=>{const t=this.pages,e=this.activePageIndex+1,i=await this.value();if(t)for(let a=e;a<t.length;a++){const e=t[a];if(await e.validate(i),e.condition)return e}return null})()}async toPrevPage(){if(this.state!=g)this.state=g;else{const t=await this.prevPage;t&&(this.activePage=t)}}async toNextPage(){const t=await this.nextPage;t?(this.activePage=t,this.state=g):this.useSummaryPage?this.summary():this.submit()}async summary(){this.state=f}get submitActions(){let t=We(this);if(!t){t=[];let e=this.attr(S);if(e){const t=this.attr(k)||"post";this.append(new Ge(e,t))}const i=this.children;for(let e of i)e instanceof Be&&t.push(e);We(this,t)}return t}async submit(){const t=await this.value();if(!await ue(t,this.pages))return;this.hasAttribute(R)||(this.state=v);const e=this.submitActions;if(e){const i=await(async(t,e)=>{const i=[];for(let a of t)if(await a.accept(e))try{const t=await a.execute(e)||new $e(a,Fe);if(i.push(t),t.state==Le)return i}catch(t){return i.push(new $e(a,Le,t)),i}return i})(e,t);this.trigger("d-form-submit-results",i)}this.trigger("d-form-submit",t)}#D(t){if(this.state==g)return this.state=p,this.#E=new Promise((e=>{setTimeout((async()=>{const i=await Ct(this.#h),a=t?t.validate(i):await ue(i,this.pages);this.#N||(this.state=g),this.validation=null,e(a)}),10)}));this.state==p&&this.#E.then((async()=>{this.#N=!1,await this.#D()}))}async childValueChanged(t,e){e=await e;const i=this.#h;t&&(Ot(e)?i.delete(t):i.set(t,e)),await this.ready;const a=this.activePage;a?await this.#D(a):await this.#D()}}ae(Ze);const Ke=Ze})()})();
//# sourceMappingURL=module-defaultjs-html-form.min.js.map