(()=>{"use strict";var t={d:(e,i)=>{for(var a in i)t.o(i,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:i[a]})}};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),t.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var e={};t.r(e),t.d(e,{BaseField:()=>Yt,Container:()=>fe,Field:()=>ue,Form:()=>Je,List:()=>Oe,Page:()=>ke});const i="d-form",a="d-control",s="d-control-back",n="d-control-next",r="d-control-summary",o="d-control-submit",l="d-page",u="d-field",c="d-list",h="d-rows",d="d-row",p="d-add-row",f="d-delete-row",g="d-container",v="d-validation",m="d-message",y="d-progress-bar",b="d-step",w="init",_="input",x="summary",A="finished",P="d-form-initialize",V="d-form-field-input",E="d-form-field-value-changed",N="d-form-execute-validate",D="d-form-active-state-changed",O="d-form-condition-state-changed",C="d-form-valid-state-changed",M="d-form-site-changed",k="d-form-state-changed",z="d-form-all-publish-value",T="d-form-submit",j="d-form-progress-bar-changed",I="d-form-list-row-add",S="d-form-list-row-delete",U="d-form-editable-state-changed",F="name",L="endpoint",R="method",$="state",q="step",G="use-summary-page",H="input-mode-after-submit",W="required",B="condition",J="active",X="disabled",Z="editable",K="editable-condition",Q="readonly",Y="no-value",tt="valid",et="invalid",it="condition-valid",at="condition-invalid",st="max",nt="progress",rt=(t,e,i,a)=>{let s=null;const n="function"==typeof e?e:()=>e,r="function"==typeof i?i:()=>i;return e=>{n(e)&&e.preventDefault(),r(e)&&e.stopPropagation();const i=(t=>({type:t.type,target:t.target,detail:t.detail,currentTarget:t.currentTarget,explicitOriginalTarget:t.explicitOriginalTarget,originalTarget:t.originalTarget,srcElement:t.srcElement,timeStamp:t.timeStamp}))(e);s&&clearTimeout(s),s=setTimeout((()=>{s=null,t(i)}),a||10)}},ot=(t,e,i=!1)=>{const a=t.active;e?t.attr(J,""):t.attr(J,null),(a!=e||i)&&t.trigger(D)},lt=(t,e,i=!1)=>{const a=t.editable;e?(t.attr(Z,""),t.attr(Q,null)):(t.attr(Z,null),t.attr(Q,"")),(a!=e||i)&&t.trigger(U)},ut=new WeakMap,ct=t=>{if(ut.has(t))return ut.get(t);const e={};return ut.set(t,e),e},ht=function(t,e,i){const a=ct(t);if(1===arguments.length)return a;if(2===arguments.length)return a[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");a[e]=i},dt=(t,e,i)=>{Object.defineProperty(t,e,{value:i,writable:!1,configurable:!1,enumerable:!1})},pt=(t,e,i)=>{Object.defineProperty(t,e,{get:i,configurable:!1,enumerable:!1})},ft=()=>{let t=null,e=null;const i=new Promise(((i,a)=>{t=i,e=a}));let a,s=!1,n=!1;return dt(i,"resolve",(i=>{a=i,s=!0,a instanceof Error?(n=!0,e(a)):t(a)})),pt(i,"value",(()=>a)),pt(i,"error",(()=>n)),pt(i,"resolved",(()=>s)),i},gt=(t,e)=>{let i="unsupported";if("string"==typeof e)i=e;else if(e instanceof HTMLElement)i=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+" is not supported as pram node!");i=e.NODENAME}return`${i.toLowerCase()}:${t}`},vt="ready",mt=new class{constructor(){dt(this,"weakmap",new WeakMap)}data(t){let e=this.weakmap.get(t);return e||(e={},this.weakmap.set(t,e)),e}value(t,e,i){if(2==arguments.length)return this.data(t)[e];this.data(t)[e]=i}};class yt extends HTMLElement{constructor({shadowRoot:t=!1,content:e=null,createUID:i=!1,uidPrefix:a="id-",uidSuffix:s=""}={}){super(),ht(this,vt,ft()),i&&this.attr("id",i(a,s)),t&&this.attachShadow({mode:open}),e&&this.root.append("function"==typeof e?e(this):e)}get root(){return this.shadowRoot||this}get ready(){return ht(this,vt)}async init(){}async destroy(){this.ready.resolved&&ht(this,vt,ft())}connectedCallback(){this.ownerDocument==document&&(t=>{const e=mt.data(t);e.initialize&&clearTimeout(e.initialize),e.initialize=setTimeout((async()=>{delete e.initialize,await t.init(),t.ready.resolve(),t.trigger(gt("initialzed",t))}),100)})(this)}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,i){e!=i&&this.isConnected&&(this.trigger(100,gt("attribute--"+t,this)),this.trigger(100,gt("change",this)))}disconnectedCallback(){this.destroy()}}const bt=yt,wt=[J,Q,B,it,at,K],_t=class extends bt{static get observedAttributes(){return wt}constructor(){super()}async init(){await super.init()}get form(){return this.__form__||(this.__form__=this.parent(i)),this.__form__}get active(){return this.hasAttribute(J)}set active(t){this.active!=t&&(ot(this,t),this.activeUpdated())}activeUpdated(){}get readonly(){return this.hasAttribute(Q)}set readonly(t){lt(this,!t,!this.ready.resolved),this.readonlyUpdated()}readonlyUpdated(){}get editable(){return this.hasAttribute(Z)}set editable(t){lt(this,t,!this.ready.resolved),this.editableUpdated()}editableUpdated(){this.readonlyUpdated()}get condition(){return!this.hasAttribute(at)}conditionUpdated(){}get valid(){return this.hasAttribute(tt)}},xt=void 0!==t.g?t.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{};class At{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,i=!0){let a=t;const s=e.split(".");let n=s.shift().trim();for(;s.length>0;){if(!a[n]){if(!i)return null;a[n]={}}a=a[n],n=s.shift().trim()}return new At(n,a)}}const Pt=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},Vt=function(t){for(let e=1;e<arguments.length;e++){const i=arguments[e];Object.getOwnPropertyNames(i).forEach((e=>{Pt(t[e])?Vt(t[e],i[e]):t[e]=i[e]}))}return t},Et=function(){const[t,e,{deep:i=!1,recursive:a=!0,parents:s=[]}={}]=arguments,n={};for(name in t){const r=t[name],o=e(name,r,t);!o||i&&null!=r?o&&i&&("object"!=typeof r||r instanceof Array||r instanceof Map||r instanceof Set||r instanceof RegExp||s.includes[r]||r==t?n[name]=r:n[name]=Et(r,e,{deep:i,recursive:a,parents:s.concat(t)})):n[name]=r}return n},Nt={isPojo:Pt,append:function(t,e,i){return void 0!==e&&(At.load(i,t,!0).append=e),i},merge:Vt,filter:Et,buildPropertyFilter:function({names:t,allowed:e}){return(i,a,s)=>t.includes(i)===e}};class Dt{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class Ot{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let i=null;if(this.data&&t in this.data)i={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;i=((t,e)=>{for(;t;){const i=t.proxy.handle.getPropertyDef(e,!1);if(i)return i;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return i.defined&&this.cache.set(t,i),i}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:i,defined:a}=this.getPropertyDef(t);a?i[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class Ct{constructor(t,e){this.handle=new Ot(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,i){return t.setProperty(e,i)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const Mt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,kt=new Dt,zt=t=>t instanceof Dt?t:new Dt(t),Tt=async function(t,e,i,a){if(i&&t.name!=i)return t.parent?Tt(t.parent,e,i,a):null;const s=await async function(t,e){if("string"!=typeof t)return t;const i=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context)`);let a,s=setTimeout((()=>{s=null,console.warn("long running statement:",t,new Error)}),1e3);try{a=await i(e)}catch(t){}return s&&clearTimeout(s),a}(e,t.proxy.data);return null!=s?s:a instanceof Dt&&a.hasValue?a.value:void 0},jt=async(t,e,i)=>e[1]?e[2]:Tt(t,e[5],It(e[4]),i),It=t=>t?0==(t=t.trim()).length?null:t:null;class St{constructor({context:t=xt,parent:e=null,name:i=null}){this.parent=e instanceof St?e:null,this.name=i,this.context=t,this.proxy=new Ct(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=At.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,i){t&&(i&&i!=this.name?this.parent&&this.parent.updateData(t,e,i):(null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context)),At.load(this.context,t).value=e,this.proxy.resetCache()))}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?Nt.merge(this.context,t):t}async resolve(t,e){const i=2==arguments.length?zt(e):kt;try{const e=Mt.exec(t);return e?await jt(this,e,i):await Tt(this,It(t),null,i)}catch(e){return console.error('error at executing statment"',t,'":',e),i.hasValue?i.value:t}}async resolveText(t,e){let i=t,a=t,s=Mt.exec(i);const n=2==arguments.length?zt(e):kt;for(;null!=s;){const t=await jt(this,s,n);a=a.split(s[0]).join(),i=i.split(s[0]).join(void 0===t?"undefined":null==t?"null":t),s=Mt.exec(a)}return i}static async resolve(t,e,i,a){const s=new St({context:e}),n=arguments.length>2?zt(i):kt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(s.resolve(t,n))}),a)})):s.resolve(t,n)}static async resolveText(t,e,i,a){const s=new St({context:e}),n=arguments.length>2?zt(i):kt;return"number"==typeof a&&a>0?new Promise((e=>{setTimeout((()=>{e(s.resolveText(t,n))}),a)})):s.resolveText(t,n)}static buildSecure({context:t,propFilter:e,option:i={deep:!0},name:a,parent:s}){return t=Nt.filter({data:t,propFilter:e,option:i}),new St({context:t,name:a,parent:s})}}const Ut=t=>{window.customElements.get(t.NODENAME)||window.customElements.define(t.NODENAME,t)},Ft="active",Lt="condition",Rt=[Ft,Lt];class $t extends bt{static get observedAttributes(){return Rt}static get NODENAME(){return v}constructor(){super()}async init(){await super.init(),this.active=!1}get active(){return this.hasAttribute(Ft)}set active(t){t?this.attr(Ft,""):this.attr(Ft,void 0)}get condition(){return this.attr(Lt)}}Ut($t);const qt=$t,Gt=({root:t,filter:e})=>{let i=[];return t.children.forEach((t=>{const{accept:a,stop:s=!1}=e(t);if(a&&i.push(t),!s){const a=Gt({root:t,filter:e});a instanceof Array?i=i.concat(a):a&&i.push(a)}})),i};class Ht{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,i=!0){let a=t;const s=e.split(".");let n=s.shift().trim();for(;s.length>0;){if(!a[n]){if(!i)return null;a[n]={}}a=a[n],n=s.shift().trim()}return new Ht(n,a)}}const Wt=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},Bt=function(t,...e){t||(t={});for(let i of e)Wt(i)&&Object.getOwnPropertyNames(i).forEach((e=>{Wt(t[e])?Bt(t[e],i[e]):t[e]=i[e]}));return t},Jt=function(){const[t,e,{deep:i=!1,recursive:a=!0,parents:s=[]}={}]=arguments,n={};for(let r in t){const o=t[r],l=e(r,o,t);!l||i&&null!=o?l&&i&&("object"!=typeof o||o instanceof Array||o instanceof Map||o instanceof Set||o instanceof RegExp||s.includes[o]||o==t?n[r]=o:n[r]=Jt(o,e,{deep:i,recursive:a,parents:s.concat(t)})):n[r]=o}return n},Xt={isPojo:Wt,append:function(t,e,i){return void 0!==e&&(Ht.load(i,t,!0).append=e),i},merge:Bt,filter:Jt,buildPropertyFilter:function({names:t,allowed:e}){return(i,a,s)=>t.includes(i)===e},defValue:(t,e,i)=>{Object.defineProperty(t,e,{value:i,writable:!1,configurable:!1,enumerable:!1})},defGet:(t,e,i)=>{Object.defineProperty(t,e,{get:i,configurable:!1,enumerable:!1})},defGetSet:(t,e,i,a)=>{Object.defineProperty(t,e,{get:i,set:a,configurable:!1,enumerable:!1})}},Zt=async t=>{const e={};e.$value=await t.value();let i=t.parent(d),a=e;for(;i;)a.$item=await i.value(),a=a.$item,i=i.parent(d);return Xt.merge(e,await t.form.data())},Kt=[F,W,Y];class Qt extends _t{static get observedAttributes(){return Kt.concat(_t.observedAttributes)}constructor(t=null){super(),this.__value__=t,this.__valueChanged__=!0,this.on(O,(t=>{t.target==this&&this.conditionUpdated()}))}async init(){await super.init(),this.ready.resolved||(this.parentField=(t=>{let e=this.parentNode;for(;e;){if(e instanceof Qt)return e;e=e.parentNode}return null})(),this.validator=new class{constructor(t){var e;this.inital=!0,this.base=t,this.customChecks=[],this.validations=Gt({root:e=t,filter:t=>{if(e!=t){if(t instanceof Yt)return{accept:!1,stop:!0};if(t instanceof qt)return{accept:!0,stop:!0}}return{accept:!1}}})||[],this.condition=t.attr(B),this.editableCondition=t.attr(K)}addCustomCheck(t){this.customChecks.push(t)}get form(){return this.base.form}async validate(){const{base:t,validations:e,customChecks:i,condition:a,editableCondition:s}=this,{hasValue:n,required:r,requiredOnlyOnActive:o}=t,l=(i.length>0||e.length,await Zt(t));this.inital,this.inital=!1;const u=!a||await St.resolve(a,l,!1);((t,e,i=!1)=>{const a=t.condition;e?(t.attr(at,null),t.attr(it,"")):(t.attr(it,null),t.attr(at,"")),(a!=e||i)&&t.trigger(O)})(t,u,this.inital);let c=!r||n;if(u){if(c)for(let e of i)await e({data:l,base:t})||(c=!1);for(let t of e)if(c&&n){const e=await St.resolve(t.condition,l,!0);t.active=!e,e||(c=!1)}else t.active=!1;const a=(async({data:t,valid:e,base:i,condition:a})=>{const{form:s}=i;if(s.state==_)if(e){if(a){const e=await St.resolve(a,t,!1);return i.editable=e,e}}else i.readonly=!1;return e})({data:l,valid:c,base:t,condition:s});a||(c=!0),((t,e,i=!1)=>{const a=t.valid;void 0===e||null==e?(t.attr(et,null),t.attr(tt,null)):e?(t.attr(et,null),t.attr(tt,"")):(t.attr(et,""),t.attr(tt,null)),(a!=e||i)&&t.trigger(C)})(t,c,this.inital)}return c}}(this),this.form.on(N,(async t=>{t.detail.indexOf(this)<0&&this.valid!=await this.validate()&&this.publishValue()})),this.form.on(z,(()=>{this.publishValue()}))),this.validate()}conditionUpdated(){this.active=this.condition}get name(){return this.getAttribute(F)}get required(){return this.hasAttribute(W)}get hasValue(){const t=this.__value__;return null!=t&&void 0!==t}async value(){if(0==arguments.length)return this.__value__;let t=arguments[0];await this.ready,await this.acceptValue(t)&&(t=await this.normalizeValue(t),this.__value__!=t&&(this.__value__=t,await this.updatedValue(t),await this.validate(),this.publishValue()))}async validate(){var t;return t=this.hasValue,this.attr(Y,t?null:""),!!this.validator&&await this.validator.validate()}async publishValue(t=[]){t.push(this),this.parentField?await this.parentField.childValueChanged(this,t):this.trigger(E,t)}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}async childValueChanged(t,e){}}const Yt=Qt;class te{static findInput(t){return null}constructor(t,e){this.field=t,this.input=e,this.init()}init(){}set readonly(t){}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}get value(){return null}get valid(){return!0}}const ee={accept:t=>t instanceof Date,value:t=>t.valueAsDate,normalize:t=>t||null},ie={text:{accept:t=>"string"==typeof t,value:t=>t.value,normalize:t=>t&&(t=t.trim()).length>0?t:null},number:{accept:t=>"number"==typeof t,value:t=>t.valueAsNumber,normalize:t=>(t=>null==t||void 0===t)(t)||Number.isNaN(t)?null:t},date:ee,time:ee},ae=(t,e)=>new Promise(((i,a)=>{const s=new FileReader;s.addEventListener("loadend",(()=>{i({name:t.name,type:t.type,size:t.size,data:s.result})}),!1),s[e](t)})),se={"form-input":async t=>(t.format="form-input",t),"data-url-base64":async t=>{const e=await ae(t,"readAsDataURL");return e.format="data-url-base64",e},base64:async t=>{const e=await ae(t,"readAsDataURL");return e.data=e.data.substr(e.data.indexOf(",")+1),e.format="base64",e}},ne=async(t,e,i)=>{let a=[];for(let i of t)a.push(await se[e](i));return 0==a.length?null:i?a:a[0]},re=[class extends te{static findInput(t){return t.find('input:not([type="file"]):not([type="radio"]):not([type="checkbox"]) ,input:not([type]), textarea').first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,i=(t.attr("input-type")||e.attr("type")||"text").trim().toLowerCase();this.type=ie[i]||ie.text,e.on("input",rt((()=>{t.trigger(V,this.normalizeValue(this.value))}),!1,!0)),t.trigger(V,this.normalizeValue(this.value))}acceptValue(t){return null==t||void 0===t||this.type.accept(t)}normalizeValue(t){return null==t&&void 0===t?null:this.type.normalize(t)}async updatedValue(t){t!=this.input.value&&this.input.val(t||null)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.type.value(this.input)}get valid(){return this.input.checkValidity()}},class extends te{static findInput(t){const e=t.find('input[type="checkbox"]');return 0==e.length?null:1==e.length?e.first():e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;this.multiple=e instanceof NodeList,e.on("input",rt((()=>{t.trigger(V,this.normalizeValue(this.value))}),!1,!0,500)),t.trigger(V,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();if(!(t instanceof Map))return t;if(0==t.size)return null;const e=[];return t.forEach((t=>{e.push(t)})),e}normalizeValue(t){return t?this.multiple?0!=(t=t.filter((t=>!!t))).length?t:null:t:null}acceptValue(t){if(null==t||void 0===t)return!0;if(this.multiple)return t instanceof Array;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}},class extends te{static findInput(t){const e=t.find('input[type="radio"]');return 0==e.length?null:e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,i=t.name+Math.floor(Math.random()*Date.now());for(let t of e)t.name=i;e.on("input",rt((()=>{t.trigger(V,this.normalizeValue(this.value))}),!1,!0,500)),t.trigger(V,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();return t instanceof Map?0==t.size?null:t.values().next().value:t}normalizeValue(t){return t||null}acceptValue(t){if(null==t||void 0===t)return!0;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}},class extends te{static findInput(t){return t.find('input[type="file"]').first()}constructor(t,e){super(t,e)}async init(){const{field:t,input:e}=this;this.multiple=e.multiple,this.format=t.attr("file-format")||"form-input",this.filenameTarget=t.attr("file-name-target"),this.filenameTarget=this.filenameTarget?t.find(this.filenameTarget).first():null;const{format:i,multiple:a}=this;e.on("input",rt((async()=>{this.updatedValue(await ne(e.files,i,a)),t.trigger(V,this.value)}),!1,!0)),e.files&&0!=e.files.length&&this.updatedValue(await ne(e.files,i,a)),t.trigger(V,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}acceptValue(t){return null==t||void 0===t||(this.multiple?t instanceof Array:t instanceof"object")}normalizeValue(t){return null==t||void 0===t?null:this.multiple?0!=t.length?t:null:t}updatedValue(t){if(t!=this.__value__&&(this.__value__=t,this.filenameTarget&&t))if(this.multiple)for(let e of t)this.filenameTarget.append(`<span>${e.name}</span>`);else this.filenameTarget.append(`<span>${t.name}</span>`)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.__value__}get valid(){return this.input.checkValidity()}},class extends te{static findInput(t){return t.find("select").first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;e.on("input, changed",rt((()=>{t.trigger(V,this.value)}),!1,!0,500)),t.trigger(V,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.normalizeValue(this.input.multiple?this.input.val():this.input.value)}normalizeValue(t){return t?this.input.multiple?0!=(t=t.filter((t=>t&&t.trim().length>0))).length?t:null:0!=(t=t.trim()).length?t:null:null}acceptValue(t){return null==t||void 0===t||(this.input.multiple?t instanceof Array:"string"==typeof t)}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}}],oe=["file-format"];class le extends Yt{static get observedAttributes(){return oe.concat(Yt.observedAttributes)}static get NODENAME(){return u}constructor(){super(),this.__valueChanged__=!0,this.on(V,(t=>{t.preventDefault(),t.stopPropagation();const e=t.detail?t.detail:null,i=!!this.__valueChanged__||this.__value__!=e;i&&(this.__valueChanged__=i,this.__value__=e,(async()=>{await this.validate(),await this.publishValue()})())}))}async init(){await super.init(),this.ready.resolved||(this.wrapper=(t=>{for(let e of re){const i=e.findInput(t);if(i)return new e(t,i)}return null})(this),this.wrapper&&this.validator.addCustomCheck((async()=>this.wrapper.valid))),this.__valueChanged__=!0,this.publishValue()}readonlyUpdated(){this.wrapper&&(this.wrapper.readonly=this.readonly)}async acceptValue(t){return!!this.wrapper&&this.wrapper.acceptValue(t)}async normalizeValue(t){return this.wrapper?this.wrapper.normalizeValue(t):t}async updatedValue(t){await this.ready,this.__valueChanged__=!0,this.wrapper&&await this.wrapper.updatedValue(t)}async publishValue(t=[]){this.__valueChanged__&&(await super.publishValue(t),this.__valueChanged__=!1)}}Ut(le);const ue=le,ce=[],he=/\./g,de=function(t,e,i){if(null==t||void 0===t)return null;const a=arguments.length>2,s=e.split(he);for(;s.length>1;){const e=s.shift();let i=t[e];const n="undefiend"!=typeof i&&null!=i;if(!n&&!a)return null;!n&&a&&(i=t[e]={}),t=i}if(!a)return t[s[0]]?t[s[0]]:null;t[s[0]]=i};class pe extends Yt{static get observedAttributes(){return ce.concat(Yt.observedAttributes)}static get NODENAME(){return g}constructor(t=null){super(t||{}),this.fields=[],this.on(E,(t=>{const e=t.target;if(e!=this){t.preventDefault(),t.stopPropagation();const i=t.detail;this.childValueChanged(e,i)}}))}async init(){const t=this.ready;await super.init(),this.fields=Gt({root:this,filter:t=>t instanceof Yt?{accept:!0,stop:!0}:{accept:!1}}),t.resolved||(this.on(P,(t=>{if(t.target!=this){const e=t.target;e instanceof Yt&&(this.fields.indexOf(e)<0&&this.fields.push(e),t.preventDefault(),t.stopPropagation())}})),this.validator.addCustomCheck((async({data:t,base:e})=>{const{fields:i}=e;if(i){const t=i.length;for(let e=0;e<t;e++){const t=i[e];if(t.condition&&!t.valid)return!1}}return!0})))}readonlyUpdated(){const{readonly:t,fields:e}=this;if(e)for(let i of e)i.readonly=t}async updatedValue(t){this.__value__={};const{fields:e}=this;if(e)for(let i of e)i.name?await i.value(de(t,i.name)):i instanceof pe&&await i.value(t)}async childValueChanged(t,e){await this.ready;const i=await t.name,a=await t.value();i?de(this.__value__,i,a):null!=a&&Xt.merge(this.__value__,a),this.validate(),this.publishValue(e)}}Ut(pe);const fe=pe,ge=[J,X],ve=class extends bt{static get observedAttributes(){return ge}static init(t){}constructor(){super(),this.active=!1,this.disabled=!1,this.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.active&&!this.disabled&&this.execute()}))}async init(){await super.init(),this.form=this.parent(i)}get active(){return this.hasAttribute(J)}set active(t){t?this.attr(J,""):this.attr(J,null)}get disabled(){return this.hasAttribute(X)}set disabled(t){t?this.attr(X,""):this.attr(X,null)}execute(){console.log("execute")}},me=[];Ut(class extends ve{static get observedAttributes(){return me.concat(me)}static get NODENAME(){return f}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(100,S)}});const ye=[];class be extends fe{static get observedAttributes(){return ye.concat(fe.observedAttributes)}static get NODENAME(){return d}constructor(){super()}get active(){return!0}set active(t){}get condition(){return!0}get name(){return null}}customElements.define(be.NODENAME,be);const we=be,_e=[];class xe extends ve{static get observedAttributes(){return _e.concat(_e)}static get NODENAME(){return p}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(100,I)}}Ut(xe);const Ae=xe,Pe=[];class Ve extends bt{static get observedAttributes(){return Pe.concat(Pe)}static get NODENAME(){return h}constructor(){super()}}customElements.define(Ve.NODENAME,Ve);const Ee=[st],Ne=async(t,e)=>{const{container:i,template:a}=t,s=document.importNode(a.content,!0).children[0];return i.append(s),e&&await s.value(e),s};class De extends Yt{static get observedAttributes(){return Ee.concat(Yt.observedAttributes)}static get NODENAME(){return c}constructor(t=null){super(t||[]),this.on(E,(t=>{const e=t.target;if(e instanceof we){t.preventDefault(),t.stopPropagation();const i=t.detail;this.childValueChanged(e,i)}})),this.on(I,(t=>{t.preventDefault(),t.stopPropagation();const{readonly:e,__value__:i}=this;if(!e){const t=Ne(this);i.push(t.value),this.validate(),this.publishValue()}})),this.on(S,(t=>{t.preventDefault(),t.stopPropagation();const{rows:e,readonly:i,__value__:a}=this;if(!i){const i=t.target.parent(d),s=e.indexOf(i);s>=0&&(i.remove(),e.splice(s,1),a.splice(s,1),this.validate(),this.publishValue())}}))}async init(){if(await super.init(),this.__value__=[],!this.ready.resolved){this.template=this.find("template").first(),this.container=this.find(h).first();const{container:t,template:e,validator:i}=this,a=Gt({root:this,filter:t=>t instanceof Ae?{accept:!0,stop:!0}:t instanceof Yt?{accept:!1,stop:!0}:{accept:!1}})[0];i.addCustomCheck((async({})=>{const{rows:t,max:e,readonly:i}=this,s=t.length;return i||(s==e?a.disabled=!0:s<e&&(a.disabled=!1)),s<=e})),i.addCustomCheck((async()=>{const{rows:t}=this;if(t)for(let e of t)if(!e.valid)return!1;return!0}))}this.validate(),this.publishValue()}readonlyUpdated(){const{readonly:t}=this;for(let e of this.rows)e.readonly=t}get rows(){return Array.from(this.container.children)}get max(){return this.hasAttribute(st)?parseInt(this.attr(st)):Number.MAX_SAFE_INTEGER}acceptValue(t){return!t||t instanceof Array}normalizeValue(t){return t.filter((t=>!!t))}async updatedValue(t){this.container.children.remove(),this.__value__=[];for(let e of t)await Ne(this,e)}async childValueChanged(t,e){await this.ready;const i=this.rows,a=await t.value(),s=i.indexOf(t);this.__value__[s]=a,await this.validate(),await this.publishValue(e)}}Ut(De);const Oe=De,Ce=[q];class Me extends fe{static get observedAttributes(){return Ce.concat(fe.observedAttributes)}static get NODENAME(){return l}constructor(){super()}async init(){await super.init()}get step(){return this.attr(q)}conditionUpdated(){}}Ut(Me);const ke=Me,ze="active",Te="condition",je=[ze,Te];Ut(class extends bt{static get observedAttributes(){return je}static get NODENAME(){return m}constructor(){super()}async init(){await super.init(),this.ready.resolved||(this.reference=(t=>{let e=this.parentNode;for(;e;){if(e instanceof _t)return e;e=e.parentNode}return null})(),this.form=this.parent(i),this.form.on(N,(()=>{this.update()}))),this.update()}get active(){return this.hasAttribute(ze)}set active(t){t?this.attr(ze,""):this.attr(ze,void 0)}get condition(){return this.attr(Te)}async update(){await this.ready;const t=await Zt(this.reference);this.active=await St.resolve(this.condition,t,!1)}});const Ie=[];Ut(class extends ve{static get observedAttributes(){return Ie}static get NODENAME(){return s}constructor(){super()}execute(){this.form.toPrevPage()}});const Se=[];Ut(class extends ve{static get observedAttributes(){return Se}static get NODENAME(){return n}constructor(){super()}execute(){this.form.toNextPage()}});const Ue=[];Ut(class extends ve{static get observedAttributes(){return Ue}static get NODENAME(){return r}constructor(){super()}execute(){this.form.toNextPage()}});const Fe=[];Ut(class extends ve{static get observedAttributes(){return Fe}static get NODENAME(){return o}constructor(){super()}execute(){this.form.submit()}});const Le={active:!0,disabled:!0},Re=[];Ut(class extends bt{static get observedAttributes(){return Re}static get NODENAME(){return a}constructor(){super()}async init(){await super.init(),this.ready.resolved||(this.form=this.parent(i),this.back=this.find(s).first()||Le,this.next=this.find(n).first()||Le,this.summary=this.find(r).first()||Le,this.submit=this.find(o).first()||Le,this.form.on([C,O],(t=>{t.target instanceof ke&&this.update()})),this.form.on([k,M],(t=>{this.update()})))}update(){const{back:t,next:e,summary:i,submit:a,form:s}=this,{activePageIndex:n,activePage:r,nextPage:o,pages:l,useSummaryPage:u,state:c}=s;t.active=!0,t.disabled=!0,e.active=!1,e.disabled=!0,i.active=!1,i.disabled=!0,a.active=!1,a.disabled=!0,c==A?(t.disabled=!0,a.active=!0):c==x?(t.disabled=!1,a.active=!0,a.disabled=!s.valid):c==_&&(t.disabled=n<=0,o||!r.valid&&n+1<l.length?(e.active=!0,e.disabled=!r.valid):u&&c==_?(i.active=!0,i.disabled=!r.valid):(a.active=!0,a.disabled=!s.valid))}});const $e=[F,J,Q];class qe extends HTMLElement{static get observedAttributes(){return $e}static get NODENAME(){return b}constructor(){super()}get name(){return this.attr(F)}get active(){return this.hasAttribute(J)}set active(t){this.active!=t&&ot(this,t)}get readonly(){return this.hasAttribute(Q)}set readonly(t){t?this.attr(Q,""):this.attr(Q,null)}}Ut(qe);const Ge=[nt];Ut(class extends bt{static get observedAttributes(){return Ge}static get NODENAME(){return y}constructor(){super(),this.on("click",(({target:t})=>{if(!this.form)return;if(t==this)return;const e=t.is(b)?t:t.parent(b).first();if(!e)return;const i=this.form.state,a=this.form.pages,s=(this.form.activePageIndex,this.form.activePage),n=e.name;if(i==_||i==x){const t=((t,e,i)=>{for(let a of t){if(a.step==e&&a.condition)return a;if(a==i)return}return null})(a,n,s);t&&(this.form.activePage=t)}}))}async init(){await super.init();const t=this.ready;this.progress=0,t.resolved||(this.form=this.parent(i),this.steps=this.find(b),this.form.on([P,M,k],(()=>{const t=this.form.state,e=this.form.activePage;if(!e)return;const i=this.form.activePageIndex,a=this.form.pages.length,s=e?e.step:w,n=Math.floor(100*i/a);for(let e of this.steps){const i=e.name;t==_?(e.active=i==s,e.readonly=!1):t==x?(e.active=i==x,e.readonly=!1):(e.active=i==A,e.readonly=!0)}this.progress=t==x||t==A?100:n,this.trigger(j)})))}get progress(){return this.attr(nt)}set progress(t){this.style.setProperty&&this.style.setProperty("--progress",t+"%"),this.attr(nt,Math.max(0,Math.min(t,100)))}});const He=[F,G,L,R,$,H],We=(t,e)=>{for(let i of t.pages)i.readonly=e,i.active=e};class Be extends bt{static get observedAttributes(){return He}static get NODENAME(){return i}constructor(){super(),this.__data__={},this.__state__=null,this.on(E,rt((async t=>{const e=t.target,i=await e.name,a=await e.value();i?this.__data__[i]=a:null!=a&&Xt.merge(this.__data__,a),this.trigger(N,t.detail)}),!0,!0))}async init(){await super.init(),this.state=w,this.ready.resolved||(this.useSummaryPage=this.hasAttribute(G),this.activePageIndex=-1,this.useSummaryPage=this.hasAttribute(G),this.pages=this.find(l)),this.activePageIndex=-1,this.pages.length>0&&this.toNextPage()}get state(){return this.__state__}set state(t){const e=this.state;e==_&&t!=_?We(this,!0):e!=_&&t==_&&(We(this,!1),this.activePage&&(this.activePage.active=!0)),this.__state__=t,e!=t&&this.trigger(k),this.attr($,this.__state__)}get valid(){for(let t of this.pages)if(!t.valid)return!1;return!0}async data(){if(0==arguments.length)return this.__data__;const t=arguments[0];if(await this.ready,this.state==_){this.__data__={};for(let e of this.pages)await e.value(null),e.name?await e.value(t[e.name]):await e.value(t);this.trigger(z)}}get activePage(){return 0<=this.activePageIndex&&this.activePageIndex<this.pages.length?this.pages[this.activePageIndex]:null}set activePage(t){const e=this.activePage;t!=e&&(e&&(e.active=!1),this.activePageIndex=this.pages.indexOf(t),t.active=!0,this.state!=_&&(this.state=_),this.trigger(M))}get prevPage(){for(let t=this.activePageIndex-1;t>=0;t--){const e=this.pages[t];if(e.condition)return e}return null}get nextPage(){if(this.pages)for(let t=this.activePageIndex+1;t<this.pages.length;t++){const e=this.pages[t];if(e.condition)return e}return null}async toPrevPage(){if(this.state!=_)this.state=_;else{const t=await this.prevPage;t&&(this.activePage=t)}}async toNextPage(){const t=await this.nextPage;t?(this.activePage=t,this.state==w&&(this._state=_)):this.useSummaryPage?this.summary():this.submit()}async summary(){this.state=x}async submit(){this.state=this.hasAttribute(H)?_:A;const t=this.data;let e=this.attr(L);if(e){e=await St.resolveText(e,t,e);const i=new URL(e,location.href);return await fetch(i.toString(),{method:(this.attr(R)||"post").toLowerCase(),credentials:"include",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify(t)})}this.trigger(T,t)}}Ut(Be);const Je=Be})();
//# sourceMappingURL=module-defaultjs-html-form.min.js.map