(()=>{"use strict";var t={365:(t,e,i)=>{i.r(e),i.d(e,{BaseField:()=>te,BaseSubmitAction:()=>Qe,Container:()=>me,Field:()=>pe,Form:()=>ri,List:()=>ze,Page:()=>je,SubmitActionResult:()=>Ze});const s=500,a="d-form",n=a,r="d-control",o="d-control-back",l="d-control-next",u="d-control-summary",c="d-control-submit",h="d-page",d="d-field",p="d-list",f="d-rows",g="d-row",v="d-add-row",m="d-delete-row",y="d-container",b="d-validation",w="d-message",x="d-progress-bar",A="d-step",P="init",V="input",E="summary",N="finished",D="d-form-initialized",O="d-form-field-initialized",C="d-form-execute-validate",M="d-form-condition-state-changed",T="d-form-field-value-changed",z="d-form-site-changed",k="d-form-state-changed",S="d-form-field-input",j="d-form-list-row-add",I="d-form-list-row-delete",F="name",U="endpoint",L="method",R="state",$="step",_="use-summary-page",B="input-mode-after-submit",q="required",G="condition",H="active",W="disabled",J="editable",X="editable-condition",Z="readonly",K="no-value",Q="valid",Y="invalid",tt="condition-valid",et="condition-invalid",it="min",st="max",at="progress",nt=new WeakMap,rt=t=>{if(nt.has(t))return nt.get(t);const e={};return nt.set(t,e),e},ot=function(t,e,i){const s=rt(t);if(1===arguments.length)return s;if(2===arguments.length)return s[e];if(3!==arguments.length)throw new Error("Not allowed size of arguments!");s[e]=i},lt=t=>function(e,i){if(2!=arguments.length)return ot(e,t);ot(e,t,i)};class ut{constructor(t,e){this.key=t,this.context=e}get keyDefined(){return this.key in this.context}get hasValue(){return!!this.context[this.key]}get value(){return this.context[this.key]}set value(t){this.context[this.key]=t}set append(t){if(this.hasValue){const e=this.value;e instanceof Array?e.push(t):this.value=[this.value,t]}else this.value=t}remove(){delete this.context[this.key]}static load(t,e,i=!0){let s=t;const a=e.split(".");let n=a.shift().trim();for(;a.length>0;){if(!s[n]){if(!i)return null;s[n]={}}s=s[n],n=a.shift().trim()}return new ut(n,s)}}const ct=function(t){return void 0!==t&&null!=t&&"Object"===t.constructor.name},ht=function(t,...e){t||(t={});for(let i of e)ct(i)&&Object.getOwnPropertyNames(i).forEach((e=>{ct(t[e])?ht(t[e],i[e]):t[e]=i[e]}));return t},dt=function(){const[t,e,{deep:i=!1,recursive:s=!0,parents:a=[]}={}]=arguments,n={};for(let r in t){const o=t[r],l=e(r,o,t);!l||i&&null!=o?l&&i&&("object"!=typeof o||o instanceof Array||o instanceof Map||o instanceof Set||o instanceof RegExp||a.includes[o]||o==t?n[r]=o:n[r]=dt(o,e,{deep:i,recursive:s,parents:a.concat(t)})):n[r]=o}return n},pt=(t,e,i)=>{Object.defineProperty(t,e,{value:i,writable:!1,configurable:!1,enumerable:!1})},ft=(t,e,i)=>{Object.defineProperty(t,e,{get:i,configurable:!1,enumerable:!1})},gt={isPojo:ct,append:function(t,e,i){return void 0!==e&&(ut.load(i,t,!0).append=e),i},merge:ht,filter:dt,buildPropertyFilter:function({names:t,allowed:e}){return(i,s,a)=>t.includes(i)===e},defValue:pt,defGet:ft,defGetSet:(t,e,i,s)=>{Object.defineProperty(t,e,{get:i,set:s,configurable:!1,enumerable:!1})}},vt=()=>{let t=null,e=null;const i=new Promise(((i,s)=>{t=i,e=s}));let s,a=!1,n=!1;return pt(i,"resolve",(i=>{s=i,a=!0,s instanceof Error?(n=!0,e(s)):t(s)})),ft(i,"value",(()=>s)),ft(i,"error",(()=>n)),ft(i,"resolved",(()=>a)),i},mt=(t,e)=>{let i="unsupported";if("string"==typeof e)i=e;else if(e instanceof HTMLElement)i=e.nodeName;else{if("string"!=typeof e.NODENAME)throw new Error(typeof e+' is not supported as parameter "node"!');i=e.NODENAME}return`${i.toLowerCase()}:${t}`},yt=lt("ready"),bt=new WeakMap,wt=t=>class extends t{constructor({shadowRoot:t=!1,content:e=null,createUID:i=!1,uidPrefix:s="id-",uidSuffix:a=""}={}){super(),yt(this,vt()),i&&this.attr("id",i(s,a)),t&&this.attachShadow({mode:open}),e&&this.root.append("function"==typeof e?e(this):e)}get root(){return this.shadowRoot||this}get ready(){return yt(this)}async init(){}async destroy(){this.ready.resolved&&yt(this,vt())}connectedCallback(){this.ownerDocument==document&&(t=>{let e=bt.get(t);e&&clearTimeout(e),bt.get(t,setTimeout((async()=>{bt.delete(t);try{await t.init(),t.ready.resolve()}catch(e){console.error("Can't initialize component!",t,e),t.ready(resolve(e))}t.trigger(mt("initialzed",t))}),100))})(this)}adoptedCallback(){this.connectedCallback()}attributeChangedCallback(t,e,i){e!=i&&this.isConnected&&(this.trigger(100,mt(`attribute--${t}`,this)),this.trigger(100,mt("change",this)))}disconnectedCallback(){this.destroy()}},xt=new Map,At=(t=>{let e=xt.get(t);return null==e&&(e=wt(t),xt.set(t,e)),e})(HTMLElement),Pt=(t,e,i=!1)=>{const s=t.active;e?t.attr(H,""):t.attr(H,null),(s!=e||i)&&t.trigger("d-form-active-state-changed")},Vt=(t,e,i=!1)=>{const s=t.editable;e?(t.attr(J,""),t.attr(Z,null)):(t.attr(J,null),t.attr(Z,"")),(s!=e||i)&&t.trigger("d-form-editable-state-changed")},Et=lt("form"),Nt=[H,Z,G,tt,et,X],Dt=class extends At{static get observedAttributes(){return Nt}constructor(){super()}async init(){await super.init()}get form(){let t=Et(this);return t||(t=this.parent(n),Et(this,t)),t}get active(){return this.hasAttribute(H)}set active(t){this.active!=t&&(Pt(this,t),this.activeUpdated())}activeUpdated(){}get readonly(){return this.hasAttribute(Z)}set readonly(t){Vt(this,!t,!this.ready.resolved),this.readonlyUpdated()}readonlyUpdated(){}get editable(){return this.hasAttribute(J)}set editable(t){Vt(this,t,!this.ready.resolved),this.editableUpdated()}editableUpdated(){this.readonlyUpdated()}get condition(){return!this.hasAttribute(et)}conditionUpdated(){}get valid(){return this.hasAttribute(Q)}};var Ot=i(302);class Ct{constructor(t){this.hasValue=1==arguments.length,this.value=t}}class Mt{constructor(t,e){this.data=t,this.resolver=e,this.cache=new Map}updateData(t){this.data=t,this.cache=new Map}resetCache(){this.cache=new Map}getPropertyDef(t,e=!0){if(this.cache.has(t))return this.cache.get(t);let i=null;if(this.data&&t in this.data)i={data:this.data,resolver:this.resolver,defined:!0};else{if(!e)return null;i=((t,e)=>{for(;t;){const i=t.proxy.handle.getPropertyDef(e,!1);if(i)return i;t=t.parent}return{data:null,resolver:null,defined:!1}})(this.resolver.parent,t)}return i.defined&&this.cache.set(t,i),i}hasProperty(t){const{defined:e}=this.getPropertyDef(t);return e}getProperty(t){const{data:e}=this.getPropertyDef(t);return e?e[t]:void 0}setProperty(t,e){const{data:i,defined:s}=this.getPropertyDef(t);s?i[t]=e:(this.data||(this.data={}),this.data[t]=e,this.cache.set(t,{data:this.data,resolver:this.resolver,defined:!0}))}deleteProperty(t){throw new Error("unsupported function!")}}class Tt{constructor(t,e){this.handle=new Mt(t,e),this.data=new Proxy(this.handle,{has:function(t,e){return t.hasProperty(e)},get:function(t,e){return t.getProperty(e)},set:function(t,e,i){return t.setProperty(e,i)},deleteProperty:function(t,e){return t.deleteProperty(e)}})}updateData(t){this.handle.updateData(t)}resetCache(){this.handle.resetCache()}}const zt=/(\\?)(\$\{(([a-zA-Z0-9\-_\s]+)::)?([^\{\}]+)\})/,kt=new Ct,St=t=>t instanceof Ct?t:new Ct(t),jt=async function(t,e,i,s){if(i&&t.name!=i)return t.parent?jt(t.parent,e,i,s):null;const a=await async function(t,e){if("string"!=typeof t)return t;const i=new Function("context",`\nreturn (async (context) => {\n\ttry{ \n\t\twith(context){\n\t\t\t return ${t}\n\t\t}\n\t}catch(e){\n\t\tthrow e;\n\t}\n})(context)`);let s,a=setTimeout((()=>{a=null,console.warn("long running statement:",t,new Error)}),1e3);try{s=await i(e)}catch(t){}return a&&clearTimeout(a),s}(e,t.proxy.data);return null!=a?a:s instanceof Ct&&s.hasValue?s.value:void 0},It=async(t,e,i)=>e[1]?e[2]:jt(t,e[5],Ft(e[4]),i),Ft=t=>t?0==(t=t.trim()).length?null:t:null;class Ut{constructor({context:t=Ot.default,parent:e=null,name:i=null}){this.parent=e instanceof Ut?e:null,this.name=i,this.context=t,this.proxy=new Tt(this.context,this)}get chain(){return this.parent?this.parent.chain+"/"+this.name:"/"+this.name}get effectiveChain(){return this.context?this.parent?this.parent.effectiveChain+"/"+this.name:"/"+this.name:this.parent?this.parent.effectiveChain:""}get contextChain(){const t=[];let e=this;for(;e;)e.context&&t.push(e.context),e=e.parent;return t}getData(t,e){if(t){if(!e||e==this.name){const e=ut.load(this.context,t,!1);return e?e.value:null}this.parent&&this.parent.getData(t,e)}}updateData(t,e,i){t&&(i&&i!=this.name?this.parent&&this.parent.updateData(t,e,i):(null!=this.context&&void 0!==this.context||(this.context={},this.proxy.updateData(this.context)),ut.load(this.context,t).value=e,this.proxy.resetCache()))}mergeContext(t,e){e&&e!=this.name?this.parent&&this.parent.mergeContext(t,e):this.context=this.context?gt.merge(this.context,t):t}async resolve(t,e){const i=2==arguments.length?St(e):kt;try{const e=zt.exec(t);return e?await It(this,e,i):await jt(this,Ft(t),null,i)}catch(e){return console.error('error at executing statment"',t,'":',e),i.hasValue?i.value:t}}async resolveText(t,e){let i=t,s=t,a=zt.exec(i);const n=2==arguments.length?St(e):kt;for(;null!=a;){const t=await It(this,a,n);s=s.split(a[0]).join(),i=i.split(a[0]).join(void 0===t?"undefined":null==t?"null":t),a=zt.exec(s)}return i}static async resolve(t,e,i,s){const a=new Ut({context:e}),n=arguments.length>2?St(i):kt;return"number"==typeof s&&s>0?new Promise((e=>{setTimeout((()=>{e(a.resolve(t,n))}),s)})):a.resolve(t,n)}static async resolveText(t,e,i,s){const a=new Ut({context:e}),n=arguments.length>2?St(i):kt;return"number"==typeof s&&s>0?new Promise((e=>{setTimeout((()=>{e(a.resolveText(t,n))}),s)})):a.resolveText(t,n)}static buildSecure({context:t,propFilter:e,option:i={deep:!0},name:s,parent:a}){return t=gt.filter({data:t,propFilter:e,option:i}),new Ut({context:t,name:s,parent:a})}}const Lt=t=>{window.customElements.get(t.NODENAME)||window.customElements.define(t.NODENAME,t)},Rt="active",$t="condition",_t=[Rt,$t];class Bt extends At{static get observedAttributes(){return _t}static get NODENAME(){return b}constructor(){super()}async init(){await super.init(),this.active=!1}get active(){return this.hasAttribute(Rt)}set active(t){t?this.attr(Rt,""):this.attr(Rt,void 0)}get condition(){return this.attr($t)}}Lt(Bt);const qt=Bt,Gt=({root:t,filter:e})=>{let i=[];return t.children.forEach((t=>{const{accept:s,stop:a=!1}=e(t);if(s&&i.push(t),!a){const s=Gt({root:t,filter:e});s instanceof Array?i=i.concat(s):s&&i.push(s)}})),i},Ht=async t=>{await t.ready;const e={};e.$value=await t.value();let i=t.parent(g),s=e;for(;i;)s.$item=await i.value(),s=s.$item,i=i.parent(g);return gt.merge(e,await t.form.value())},Wt=/\./g,Jt=function(t,e,i){if(null==t||void 0===t)return null;const s=arguments.length>2,a=e.split(Wt);for(;a.length>1;){const e=a.shift();let i=t[e];const n="undefiend"!=typeof i&&null!=i;if(!n&&!s)return null;!n&&s&&(i=t[e]={}),t=i}if(!s)return t[a[0]]?t[a[0]]:null;t[a[0]]=i},Xt=lt("parent"),Zt=lt("value"),Kt=lt("validator"),Qt=[F,q,K];class Yt extends Dt{static get observedAttributes(){return Qt.concat(Dt.observedAttributes)}constructor(t=null){super(),Zt(this,t),this.on(M,(t=>{t.target==this&&this.conditionUpdated()}))}async init(){await super.init();const t=this.ready;t.resolved||(Xt(this,(t=>{let e=this.parentNode;for(;e;){if(e instanceof Yt)return e;e=e.parentNode}return null})()),Kt(this,new class{constructor(t){var e;this.inital=!0,this.base=t,this.customChecks=[],this.validations=Gt({root:e=t,filter:t=>{if(e!=t){if(t instanceof te)return{accept:!1,stop:!0};if(t instanceof qt)return{accept:!0,stop:!0}}return{accept:!1}}})||[],this.condition=t.attr(G),this.editableCondition=t.attr(X)}addCustomCheck(t){this.customChecks.push(t)}get form(){return this.base.form}async validate(){const{base:t,validations:e,customChecks:i,condition:s,editableCondition:a}=this,{hasValue:n,required:r}=t,o=await Ht(t),l=this.inital;this.inital=!1;const u=!s||await Ut.resolve(s,o,!1);((t,e,i=!1)=>{const s=t.condition;e?(t.attr(et,null),t.attr(tt,"")):(t.attr(tt,null),t.attr(et,"")),(s!=e||i)&&t.trigger(M)})(t,u,l);let c=!r||n;if(u){if(c)for(let e of i)await e({data:o,base:t})||(c=!1);for(let t of e)if(c&&n){const e=await Ut.resolve(t.condition,o,!0);t.active=!e,e||(c=!1)}else t.active=!1;const s=await(async({data:t,valid:e,base:i,condition:s})=>{const{form:a}=i;if(a.state==V&&s){const e=await Ut.resolve(s,t,!1);return i.editable=e,e}return!0})({data:o,valid:c,base:t,condition:a});s||(c=!0),((t,e,i=!1)=>{const s=t.valid;void 0===e||null==e?(t.attr(Y,null),t.attr(Q,null)):e?(t.attr(Y,null),t.attr(Q,"")):(t.attr(Y,""),t.attr(Q,null)),(s!=e||i)&&t.trigger("d-form-valid-state-changed")})(t,c,l)}return c}}(this)),this.form.on(C,(async t=>{if(t.detail.indexOf(this)<0){const t=this.valid,e=await this.validate(),i=this.condition;t!=e&&i&&this.publishValue()}})),this.form.on("d-form-all-publish-value",(()=>{this.publishValue()})),t.then((()=>{this.trigger(O)}))),t.then((async()=>{await this.validate(),await this.publishValue()}))}get validator(){return Kt(this)}get parentField(){return Xt(this)}conditionUpdated(){this.active=this.condition,(async()=>{this.publishValue()})()}get name(){return this.getAttribute(F)}get required(){return this.hasAttribute(q)}get hasValue(){const t=Zt(this);return null!=t&&void 0!==t}async value(t){if(0==arguments.length)return Zt(this);await this.ready;const e=Zt(this);await this.acceptValue(t)&&e!=(t=await this.normalizeValue(t))&&(Zt(this,t),await this.updatedValue(t),await this.validate(),await this.publishValue())}async validate(){var t;return t=this.hasValue,this.attr(K,t?null:""),!!this.validator&&await this.validator.validate()}async publishValue(t=[]){await this.ready,t.push(this),this.parentField?await this.parentField.childValueChanged(this,t):this.trigger(T,t)}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}async childValueChanged(t,e){}}const te=Yt,ee=(t,e,i,s)=>{let a=null;const n="function"==typeof e?e:()=>e,r="function"==typeof i?i:()=>i;return e=>{n(e)&&e.preventDefault(),r(e)&&e.stopPropagation();const i=(t=>({type:t.type,target:t.target,detail:t.detail,currentTarget:t.currentTarget,explicitOriginalTarget:t.explicitOriginalTarget,originalTarget:t.originalTarget,srcElement:t.srcElement,timeStamp:t.timeStamp}))(e);a&&clearTimeout(a),a=setTimeout((()=>{a=null,t(i)}),s||10)}};class ie{static findInput(t){return null}constructor(t,e){this.field=t,this.input=e,this.init()}init(){}set readonly(t){}async acceptValue(t){return!0}async normalizeValue(t){return t}async updatedValue(){}get value(){return null}get valid(){return!0}}const se=t=>({accept:t=>"number"==typeof t,getValue:()=>t.valueAsNumber,setValue:e=>{t.valueAsNumber=e},normalize:t=>(t=>null==t||void 0===t)(t)||Number.isNaN(t)?null:t}),ae=t=>({accept:t=>t instanceof Date,getValue:()=>t.valueAsDate,setValue:e=>{t.valueAsDate=e},normalize:t=>t||null}),ne={text:t=>({accept:t=>"string"==typeof t,getValue:()=>t.value,setValue:e=>t.value=e,normalize:t=>t&&(t=t.trim()).length>0?t:null}),number:se,date:ae,time:ae,range:se},re=lt("value"),oe=(t,e)=>new Promise(((i,s)=>{const a=new FileReader;a.addEventListener("loadend",(()=>{i({name:t.name,type:t.type,size:t.size,data:a.result})}),!1),a[e](t)})),le={"form-input":async t=>(t.format="form-input",t),"data-url-base64":async t=>{const e=await oe(t,"readAsDataURL");return e.format="data-url-base64",e},base64:async t=>{const e=await oe(t,"readAsDataURL");return e.data=e.data.substr(e.data.indexOf(",")+1),e.format="base64",e}},ue=async(t,e,i)=>{let s=[];for(let i of t)s.push(await le[e](i));return 0==s.length?null:i?s:s[0]},ce=[class extends ie{static findInput(t){return t.find('input:not([type="file"]):not([type="radio"]):not([type="checkbox"]) ,input:not([type]), textarea').first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,i=(t.attr("input-type")||e.attr("type")||"text").trim().toLowerCase();this.type=(ne[i]||ne.text)(e),e.on("input",ee((()=>{t.trigger(S,this.normalizeValue(this.value))}),!1,!0,s)),t.trigger(S,this.normalizeValue(this.value))}acceptValue(t){return null==t||void 0===t||this.type.accept(t)}normalizeValue(t){return null==t&&void 0===t?null:this.type.normalize(t)}async updatedValue(t){t!=this.type.getValue()&&this.type.setValue(t)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.type.getValue()}get valid(){return this.input.checkValidity()}},class extends ie{static findInput(t){const e=t.find('input[type="checkbox"]');return 0==e.length?null:1==e.length?e.first():e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;this.multiple=e instanceof NodeList,e.on("input",ee((()=>{t.trigger(S,this.normalizeValue(this.value))}),!1,!0,s)),t.trigger(S,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();if(!(t instanceof Map))return t;if(0==t.size)return null;const e=[];return t.forEach((t=>{e.push(t)})),e}normalizeValue(t){return t?this.multiple?0!=(t=t.filter((t=>!!t))).length?t:null:t:null}acceptValue(t){if(null==t||void 0===t)return!0;if(this.multiple)return t instanceof Array;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}},class extends ie{static findInput(t){const e=t.find('input[type="radio"]');return 0==e.length?null:e}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this,i=t.name+Math.floor(Math.random()*Date.now());for(let t of e)t.name=i;e.on("input",ee((()=>{t.trigger(S,this.normalizeValue(this.value))}),!1,!0,s)),t.trigger(S,this.normalizeValue(this.value))}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){const t=this.input.val();return t instanceof Map?0==t.size?null:t.values().next().value:t}normalizeValue(t){return t||null}acceptValue(t){if(null==t||void 0===t)return!0;{const e=typeof t;return"string"===e||"boolean"===e}}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}},class extends ie{static findInput(t){return t.find('input[type="file"]').first()}constructor(t,e){super(t,e)}async init(){const{field:t,input:e}=this;this.multiple=e.multiple,this.format=t.attr("file-format")||"form-input",this.filenameTarget=t.attr("file-name-target"),this.filenameTarget=this.filenameTarget?t.find(this.filenameTarget).first():null;const{format:i,multiple:s}=this;e.on("input",ee((async()=>{this.updatedValue(await ue(e.files,i,s)),t.trigger(S,this.value)}),!1,!0)),e.files&&0!=e.files.length&&this.updatedValue(await ue(e.files,i,s)),t.trigger(S,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}acceptValue(t){return null==t||void 0===t||(this.multiple?t instanceof Array:"object"==typeof t)}normalizeValue(t){return null==t||void 0===t?null:this.multiple?0!=t.length?t:null:t}updatedValue(t){if(t!=re(this)){re(this,t),t||(this.input.value=null);const e=this.filenameTarget;if(e&&(e.empty(),t))if(this.multiple)for(let i of t)e.append(`<span>${i.name}</span>`);else e.append(`<span>${t.name}</span>`)}}get value(){return re(this)}get valid(){return this.input.checkValidity()}},class extends ie{static findInput(t){return t.find("select").first()}constructor(t,e){super(t,e)}init(){const{field:t,input:e}=this;e.on("input, changed",ee((()=>{t.trigger(S,this.value)}),!1,!0,s)),t.trigger(S,this.value)}set readonly(t){this.input.attr("disabled",t?"":null)}get value(){return this.normalizeValue(this.input.multiple?this.input.val():this.input.value)}normalizeValue(t){return t?this.input.multiple?0!=(t=t.filter((t=>t&&t.trim().length>0))).length?t:null:0!=(t=t.trim()).length?t:null:null}acceptValue(t){return null==t||void 0===t||(this.input.multiple?t instanceof Array:"string"==typeof t)}updatedValue(t){this.field.value!=this.value&&this.input.val(t||null)}}],he=["file-format"];class de extends te{static get observedAttributes(){return he.concat(te.observedAttributes)}static get NODENAME(){return d}constructor(t=null){super(t),this.on(S,(t=>{t.preventDefault(),t.stopPropagation();const e=t.detail?t.detail:null;(async()=>{await this.value()!=e&&this.value(e)})()}))}async init(){await super.init(),this.ready.resolved||(this.wrapper=(t=>{for(let e of ce){const i=e.findInput(t);if(i)return new e(t,i)}return null})(this),this.wrapper&&this.validator.addCustomCheck((async()=>this.wrapper.valid)))}readonlyUpdated(){this.wrapper&&(this.wrapper.readonly=this.readonly)}async acceptValue(t){return!!this.wrapper&&this.wrapper.acceptValue(t)}async normalizeValue(t){return this.wrapper?this.wrapper.normalizeValue(t):t}async updatedValue(t){await this.ready,this.wrapper&&await this.wrapper.updatedValue(t)}}Lt(de);const pe=de,fe=[],ge=async t=>{const e={},i=t.fields;for(let t of i)if(t.condition&&t.hasValue){const i=t.name,s=await t.value();i?Jt(e,i,s):Object.assign(e,s)}Object.getOwnPropertyNames(e).length>0?Zt(t,e):Zt(t,null)};class ve extends te{static get observedAttributes(){return fe.concat(te.observedAttributes)}static get NODENAME(){return y}constructor(t=null){super(t),this.fields=[],this.on(T,(t=>{const e=t.target;if(e!=this){t.preventDefault(),t.stopPropagation();const i=t.detail;this.childValueChanged(e,i)}}))}async init(){const t=this.ready;await super.init(),this.fields=Gt({root:this,filter:t=>t instanceof te?{accept:!0,stop:!0}:{accept:!1}}),t.resolved||(this.on(O,(t=>{const e=t.target;e!=this&&(e instanceof te&&this.fields.indexOf(e)<0&&(this.fields.push(e),ge(this)),t.preventDefault(),t.stopPropagation())})),this.validator.addCustomCheck((async({data:t,base:e})=>{const{fields:i}=e;if(i){const t=i.length;for(let e=0;e<t;e++){const t=i[e];if(t.condition&&!t.valid)return!1}}return!0})))}readonlyUpdated(){const{readonly:t,fields:e}=this;if(e)for(let i of e)i.readonly=t}async updatedValue(t){await this.ready;const e=this.fields;if(e){for(let i of e)i.name?await i.value(Jt(t,i.name)):i instanceof ve&&await i.value(t);await ge(this)}}async childValueChanged(t,e){await this.ready,await ge(this),await this.validate(),await this.publishValue(e)}}Lt(ve);const me=ve,ye=[H,W],be=class extends At{static get observedAttributes(){return ye}static init(t){}constructor(){super(),this.active=!1,this.disabled=!1,this.on("click",(t=>{t.preventDefault(),t.stopPropagation(),this.active&&!this.disabled&&this.execute()}))}async init(){await super.init(),this.form=this.parent(n)}get active(){return this.hasAttribute(H)}set active(t){t?this.attr(H,""):this.attr(H,null)}get disabled(){return this.hasAttribute(W)}set disabled(t){t?this.attr(W,""):this.attr(W,null)}execute(){console.log("execute")}},we=[];Lt(class extends be{static get observedAttributes(){return we.concat(we)}static get NODENAME(){return m}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(100,I)}});const xe=[];class Ae extends me{static get observedAttributes(){return xe.concat(me.observedAttributes)}static get NODENAME(){return g}constructor(){super()}get active(){return!0}set active(t){}get condition(){return!0}get name(){return null}}customElements.define(Ae.NODENAME,Ae);const Pe=Ae,Ve=[];class Ee extends be{static get observedAttributes(){return Ve.concat(Ve)}static get NODENAME(){return v}constructor(){super()}async init(){await super.init(),this.active=!0}execute(){this.trigger(100,j)}}Lt(Ee);const Ne=Ee,De=[];class Oe extends At{static get observedAttributes(){return De.concat(De)}static get NODENAME(){return f}constructor(){super()}}customElements.define(Oe.NODENAME,Oe);const Ce=[it,st],Me=async(t,e)=>{const{container:i,template:s}=t,a=document.importNode(s.content,!0).children[0];return i.append(a),e&&await a.value(e),a};class Te extends te{static get observedAttributes(){return Ce.concat(te.observedAttributes)}static get NODENAME(){return p}constructor(t=null){super(t),this.on(O,(t=>{t.preventDefault(),t.stopPropagation()})),this.on(T,(t=>{const e=t.target;if(e instanceof Pe){t.preventDefault(),t.stopPropagation();const i=t.detail;this.childValueChanged(e,i)}})),this.on(j,(t=>{t.preventDefault(),t.stopPropagation();const{readonly:e}=this;e||(Me(this),this.childValueChanged())})),this.on(I,(t=>{t.preventDefault(),t.stopPropagation();const{rows:e,readonly:i}=this;if(!i){const i=t.target.parent(g);e.indexOf(i)>=0&&(i.remove(),this.childValueChanged())}}))}async init(){if(await super.init(),!this.ready.resolved){this.template=this.find("template").first(),this.container=this.find(f).first();const t=this.validator,e=Gt({root:this,filter:t=>t instanceof Ne?{accept:!0,stop:!0}:t instanceof te?{accept:!1,stop:!0}:{accept:!1}})[0];t.addCustomCheck((async({})=>{const{rows:t,min:i,max:s,readonly:a}=this,n=t.length;return a||(n==s?e.disabled=!0:n<s&&(e.disabled=!1)),i<=n&&n<=s})),t.addCustomCheck((async()=>{const{rows:t}=this;if(t)for(let e of t)if(!e.valid)return!1;return!0}))}this.validate(),this.publishValue()}readonlyUpdated(){const{readonly:t}=this;for(let e of this.rows)e.readonly=t}get rows(){return Array.from(this.container.children)}get min(){return this.hasAttribute(it)?Math.max(0,parseInt(this.attr(it))):0}get max(){return this.hasAttribute(st)?parseInt(this.attr(st)):Number.MAX_SAFE_INTEGER}acceptValue(t){return!t||t instanceof Array}normalizeValue(t){return t?t.filter((t=>!!t)):null}async updatedValue(t){if(this.container.children.remove(),t)for(let e of t)await Me(this,e)}async childValueChanged(t,e){await this.ready;const i=[];for(let t of this.rows){const e=await t.value();e&&i.push(e)}i.length>0?Zt(this,i):Zt(this,null),await this.validate(),await this.publishValue(e)}}Lt(Te);const ze=Te,ke=[$];class Se extends me{static get observedAttributes(){return ke.concat(me.observedAttributes)}static get NODENAME(){return h}constructor(t){super(t)}async init(){await super.init()}get step(){return this.attr($)}conditionUpdated(){}}Lt(Se);const je=Se,Ie="active",Fe="condition",Ue=[Ie,Fe];Lt(class extends At{static get observedAttributes(){return Ue}static get NODENAME(){return w}constructor(){super()}async init(){await super.init();const t=this.ready;t.resolved||(this.reference=(t=>{let e=this.parentNode;for(;e;){if(e instanceof Dt)return e;e=e.parentNode}return null})(),this.form=this.parent(n),this.form.on(C,(()=>{this.update()})),t.then((()=>{this.update()})))}get active(){return this.hasAttribute(Ie)}set active(t){t?this.attr(Ie,""):this.attr(Ie,void 0)}get condition(){return this.attr(Fe)}async update(){await this.ready;const t=await Ht(this.reference);this.active=await Ut.resolve(this.condition,t,!1)}});const Le=[];Lt(class extends be{static get observedAttributes(){return Le}static get NODENAME(){return o}constructor(){super()}execute(){this.form.toPrevPage()}});const Re=[];Lt(class extends be{static get observedAttributes(){return Re}static get NODENAME(){return l}constructor(){super()}execute(){this.form.toNextPage()}});const $e=[];Lt(class extends be{static get observedAttributes(){return $e}static get NODENAME(){return u}constructor(){super()}execute(){this.form.toNextPage()}});const _e=[];Lt(class extends be{static get observedAttributes(){return _e}static get NODENAME(){return c}constructor(){super()}execute(){this.form.submit()}});const Be={active:!0,disabled:!0},qe=[];Lt(class extends At{static get observedAttributes(){return qe}static get NODENAME(){return r}constructor(){super()}async init(){await super.init(),this.ready.resolved||(this.form=this.parent(n),this.back=this.find(o).first()||Be,this.next=this.find(l).first()||Be,this.summary=this.find(u).first()||Be,this.submit=this.find(c).first()||Be,this.form.on([D,T,k,M,z],(t=>{this.update()})))}update(){const{back:t,next:e,summary:i,submit:s,form:a}=this,{activePageIndex:n,activePage:r,nextPage:o,pages:l,useSummaryPage:u,state:c}=a;t.active=!0,t.disabled=!0,e.active=!1,e.disabled=!0,i.active=!1,i.disabled=!0,s.active=!1,s.disabled=!0,c==N?(t.disabled=!0,s.active=!0):c==E?(t.disabled=!1,s.active=!0,s.disabled=!a.valid):c==V&&(t.disabled=n<=0,o||!r.valid&&n+1<l.length?(e.active=!0,e.disabled=!r.valid):u&&c==V?(i.active=!0,i.disabled=!r.valid):(s.active=!0,s.disabled=!a.valid))}});const Ge=[F,H,Z];class He extends HTMLElement{static get observedAttributes(){return Ge}static get NODENAME(){return A}constructor(){super()}get name(){return this.attr(F)}get active(){return this.hasAttribute(H)}set active(t){this.active!=t&&Pt(this,t)}get readonly(){return this.hasAttribute(Z)}set readonly(t){t?this.attr(Z,""):this.attr(Z,null)}}Lt(He);const We=[at];Lt(class extends At{static get observedAttributes(){return We}static get NODENAME(){return x}constructor(){super(),this.on("click",(({target:t})=>{if(!this.form)return;if(t==this)return;const e=t.is(A)?t:t.parent(A);if(!e)return;const i=this.form.state,s=this.form.pages,a=this.form.activePage,n=e.name;if(i==V||i==E){const t=((t,e,i)=>{for(let s of t){if(s.step==e&&s.condition)return s;if(s==i)return}return null})(s,n,a);t&&(this.form.activePage=t)}}))}async init(){await super.init();const t=this.ready;this.progress=0,t.resolved||(this.form=this.parent(n),this.steps=this.find(A),this.form.on([z,k],(()=>{const t=this.form.state,e=this.form.activePage;if(!e)return;const i=this.form.activePageIndex,s=this.form.pages.length,a=e?e.step:P,n=Math.floor(100*i/s);for(let e of this.steps){const i=e.name;t==V?(e.active=i==a,e.readonly=!1):t==E?(e.active=i==E,e.readonly=!1):(e.active=i==N,e.readonly=!0)}this.progress=t==E||t==N?100:n,this.trigger("d-form-progress-bar-changed")})))}get progress(){return this.attr(at)}set progress(t){this.style.setProperty&&this.style.setProperty("--progress",t+"%"),this.attr(at,Math.max(0,Math.min(t,100)))}});const Je="success",Xe="fail",Ze=class{static get STATE_SUCCESS(){return Je}static get STATE_FAIL(){return Xe}constructor(t,e,i,s){this.action=t,this.state=e,this.message=i,this.data=s}},Ke=lt("form"),Qe=class extends At{constructor(){super()}async init(){await super.init();const t=this.parent(a);Ke(this,t),t&&this.trigger("d-form-initializesubmit-action")}get form(){return Ke(this)}async accept(t={}){const e=this.attr(G);return!e||await Ut.resolve(e,t,!1)}async execute(t={}){return new Ze(Xe,"not implemented")}};class Ye extends Qe{static get NODENAME(){return"d-submit-action-default"}constructor(t,e){super(),this.endpoint=t,this.method=e}async execute(t){let e=this.endpoint;e=await ExpressionResolver.resolveText(e,t,e);const i=new URL(e,location),s=await fetch(i,{method:this.method,credentials:"include",mode:"cors",headers:{"content-type":"application/json"},body:JSON.stringify(t)});return new Ze(this,s.ok?Je:Xe,s)}}!function(t,e){const i=t.NODENAME;customElements.get(i)||customElements.define(i,t,e)}(Ye);const ti=Ye,ei=lt("submitAction"),ii=lt("state"),si=[F,_,U,L,R,B],ai=(t,e)=>{for(let i of t.pages)i.readonly=e,i.active=e};class ni extends At{static get observedAttributes(){return si}static get NODENAME(){return n}constructor(){super(),ii(this,null),this.on(T,(t=>{t.stopPropagation();const e=t.detail;this.trigger(C,e)}))}async init(){await super.init(),this.state=P,this.ready.resolved||(this.useSummaryPage=this.hasAttribute(_),this.activePageIndex=-1,this.useSummaryPage=this.hasAttribute(_),this.pages=this.find(h),this.trigger(D)),this.activePageIndex=-1,this.pages.length>0&&this.toNextPage()}get state(){return ii(this)}set state(t){const e=this.state;e==V&&t!=V?ai(this,!0):e!=V&&t==V&&(ai(this,!1),this.activePage&&(this.activePage.active=!0)),ii(this,t),e!=t&&this.trigger(k),this.attr(R,t)}get valid(){for(let t of this.pages)if(t.condition&&!t.valid)return!1;return!0}async value(t){if(0==arguments.length)return(async t=>{await t.ready;const e={},i=t.pages;for(let t of i)if(t.condition){const i=t.name,s=await t.value(),a=null!=s&&void 0!==s;i&&a?Jt(e,i,s):a&&gt.merge(e,s)}return e})(this);if(await this.ready,this.state==V)for(let e of this.pages){const i=e.name;i?await e.value(Jt(t,i)):await e.value(t)}}get activePage(){return 0<=this.activePageIndex&&this.activePageIndex<this.pages.length?this.pages[this.activePageIndex]:null}set activePage(t){const e=this.activePage;t==e&&this.state==V||(e&&(e.active=!1),this.activePageIndex=this.pages.indexOf(t),t.active=!0,this.state!=V&&(this.state=V),this.scrollIntoView(),this.trigger(z))}get prevPage(){for(let t=this.activePageIndex-1;t>=0;t--){const e=this.pages[t];if(e.condition)return e}return null}get nextPage(){if(this.pages)for(let t=this.activePageIndex+1;t<this.pages.length;t++){const e=this.pages[t];if(e.condition)return e}return null}async toPrevPage(){if(this.state!=V)this.state=V;else{const t=await this.prevPage;t&&(this.activePage=t)}}async toNextPage(){const t=await this.nextPage;t?(this.activePage=t,this.state==P&&(this._state=V)):this.useSummaryPage?this.summary():this.submit()}async summary(){this.state=E}get submitActions(){let t=ei(this);if(!t){t=[];let e=this.attr(U);if(e){const t=this.attr(L)||"post";this.append(new ti(e,t))}const i=this.children;for(let e of i)e instanceof Qe&&t.push(e);ei(this,t)}return t}async submit(){this.state=this.hasAttribute(B)?V:N;const t=await this.value(),e=this.submitActions;if(e){const i=await(async(t,e)=>{const i=[];for(let s of t)if(await s.accept(e))try{const t=await s.execute(e)||new Ze(s,Je);if(i.push(t),t.state==Xe)return i}catch(t){return i.push(new Ze(s,Xe,t)),i}return i})(e,t);this.trigger("d-form-submit-results",i)}this.trigger("d-form-submit",t)}}Lt(ni);const ri=ni},302:(t,e,i)=>{i.r(e),i.d(e,{default:()=>s});const s=void 0!==i.g?i.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{}}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};(()=>{i.r(s);var t=i(302),e=i(365);t.default.defaultjs=t.default.defaultjs||{},t.default.defaultjs.html=t.default.defaultjs.html||{},t.default.defaultjs.html.form=t.default.defaultjs.html.form||{VERSION:"1.2.20",Form:e.Form,Page:e.Page,BaseField:e.BaseField,Field:e.Field,Container:e.Container,List:e.List,BaseSubmitAction:e.BaseSubmitAction,SubmitActionResult:e.SubmitActionResult}})()})();
//# sourceMappingURL=browser-defaultjs-html-form.min.js.map